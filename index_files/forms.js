var masonryactive=false;var ismob=false;var leftMap=false;var MyBalloonLayout,MyBalloonContentLayout;var prevModal=false;var startWindowScrollIdea=0;window.lastCall=false;function matchYoutubeUrl(url){var p=/^(?:(http|https)?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;var res=url.match(p);return(res)?res[2]:false;}function matchVimeoUrl(url){var p=/(http|https)?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/;var res=url.match(p);return(res)?res[4]:false;}function initIdeaFav(){$('.ideasfav:not(.processed)').click(function(e){e.preventDefault();var ths=this;$.ajax({url:'/api/ideas/fav/',method:'post',dataType:'json',data:{id:$(this).data('id')},cache:false,success:function(data){let cnt;if(data.status){if(data.data){if(data.data==='added'){if($(ths).has('.ideasfavtext')){$(ths).find('.ideasfavtext').html('Сохранено');}if($(ths).has('.favCount')){cnt=parseInt($(ths).find('.favCount').html());cnt++;$(ths).find('.favCount').html(cnt);}$(ths).addClass('active');}if(data.data==='deleted'){if($('#pageIDdesktop').length){$(ths).parents('.one-idea-item').fadeOut(400,function(){$(this).remove();$('.idea-masonry').masonry('layout');$('.lk-info-filt li span').html(parseInt($('.lk-info-filt li span').text())-1);});}if($(ths).has('.ideasfavtext')){$(ths).find('.ideasfavtext').html('Сохранить');}if($(ths).has('.favCount')){cnt=parseInt($(ths).find('.favCount').html());cnt--;$(ths).find('.favCount').html(cnt);}$(ths).removeClass('active');}}}else{if(data.data&&data.data==='auth'){saveThisByHref(ths);if($('.mfp-ready').length){$('.mfp-close').click();setTimeout(function(){if($('#regMod').length){$('#regMod').modal('show');}},400);}else{if($('#Idea:visible').length){$('#Idea:visible .close-add').click();setTimeout(function(){if($('#regMod').length){$('#regMod').modal('show');}},400);}else{if($('#regMod').length){$('#regMod').modal('show');}}}}}}});}).addClass('processed');}function uniqueId(){return'ID'+Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9);}$(function(){$('.allReviews').click(function(e){e.preventDefault();var id=$(this).parents('.modal-gallery').find('.sbOrderForm input[name=user_id]').val();$.ajax({url:'/api/loadReviewsObj/',data:{id:id,page:1,loadreviews:1},method:'post',success:function(data){var gal=[];let html='';if(data.status&&data.data.data.length){for(let i=0;i<data.data.data.length;i++){let uid=uniqueId();gal[i]={href:'#'+uid,type:'inline'};html=html+'<div class="hiddenFeedback" id="'+uid+'">\n\
<span class="revAva" style="background-image: url(\''+data.data.data[i].photo+'\');"></span>\n\
<h4>'+data.data.data[i].name+'<span>'+data.data.data[i].add_date+'</span></h4>\n\
'+data.data.data[i].text+'</div>';}$('body').append(html);$.fancybox.open(gal,{margin:0,padding:20,maxWidth:480,closeBtn:true,afterClose:function(){$(".hiddenFeedback").remove();},helpers:{overlay:{locked:false}}});}}});});$('.scrollToEl').click(function(e){e.preventDefault();let el=$(this).attr('href').split('#');if(el.length>1){el=$('#'+el[1]);if(el.length){$([document.documentElement,document.body]).animate({scrollTop:el.offset().top},1500);}}});ismob=$(window).width()<992;$(window).resize(function(){ismob=$(window).width()<992;});$('.downlink').click(function(e){e.preventDefault();var data={file_id:$(this).data('id')};$.ajax({url:'/api/client/getDownLink/',method:'post',dataType:'json',data:data,cache:false,success:function(data){if(data){if(data.status&&data.data&&data.data.link){window.open(data.data.link);}else{if(data.error==='down_limit'){alert('Вы скачали этот файл слишком много раз. Обратитесь в поддержку.');}else{alert('Системная ошибка: '+data.error);window.location.reload();}}}else{window.location.reload();}}});});$(".masked-tel:not(.processed)").inputmask("+7 (999) 999-99-99").addClass('processed');$('.scrollto').click(function(e){e.preventDefault();scrollTo($(this).attr('href'));});$.magnificPopup&&$('.mag-link').magnificPopup({fixedBgPos:!0,fixedContentPos:!0,showCloseBtn:!0,removalDelay:0,preloader:!0,type:"inline",mainClass:"mfp-fade mfp-s-loading"});if($('.sharePage').length){$('.sharePage').click(function(e){e.preventDefault();let tmp=window.location.href.split('#');tmp=tmp[0];if($(this).hasClass('fb')){tmp='https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(tmp);var hght=740,wdth=550,top=0,left=0;}else if($(this).hasClass('vk')){tmp='http://vkontakte.ru/share.php?url='+encodeURIComponent(tmp);var hght=570,wdth=650,top=0,left=0;}if(typeof hght!=='undefined'){left=($(window).width()-wdth)/2;top=($(window).height()-hght)/2;tmp=window.open(tmp,'shareWindow',"width="+wdth+",height="+hght+",left="+left+",top="+top+",resizable=no,scrollbars=no,status=no");}});}if($('.subscription-form').length){$('.subscription-form').submit(function(e){var emtest=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e.preventDefault();if($(this).find('input[name="email"]').val()&&emtest.test($(this).find('input[name="email"]').val()+'')){var data=$(this).serializeArray();$.ajax({url:'/api/subscription.php',method:'post',dataType:'json',data:data,success:function(data){$('#congrat2 .modal_title').html('Спасибо за подписку!');$('#congrat2 .modal_message').html('<p style="margin-top: 30px;">Теперь вы можете получить бесплатный доступ к нашему свадебному онлайн-планировщику.<br />Это <span style="font-weight: 600">7</span> уникальных и действительно полезных инструментов для самостоятельной подготовки к свадьбе.</p><p style="margin-bottom: 40px;">Пройдите быструю регистрацию и, надеемся, они вам понравятся :)</p>');getModalNew('congrat2');}});}else{$(this).find('input[name="email"]').addClass('error').keyup(function(){$(this).unbind('keyup').removeClass('error');});}});}init_formbuttons();$('#order-step2-form').submit(function(e){e.preventDefault();var place;var ths=this;if(validate_form(this)){var data=$(this).serializeArray();if(data.length){for(let l=0;l<data.length;l++){if(data[l].name==='place'){data[l].name='position';if(parseBool(data[l].value)){data[l].value='from-catalog-item-banket';}else{data[l].value='from-catalog-item';}}}data.push({name:'action',value:'fast-order'});data=convertToObject(data);var bkp=$(ths).find('.main-button__text').html();$(ths).find('.main-button__text').html('<i class="fa fa-spinner fa-pulse"></i>');$.ajax({url:'/modules/send-fo-email.php',dataType:'json',data:data,method:'post',success:function(json){if(json&&parseBool(json)===true){$(ths).find('.main-button__text').html(bkp);setOrderCongrat('congrat1',data.position);getModalNew('congrat1');}}});}}});$('#order-step2-form-podbor').submit(function(e){e.preventDefault();var place;var ths=this;if(validate_form(this)){var data=$(this).serializeArray();if(data.length){data.push({name:'action',value:'fast-order'});data=convertToObject(data);var bkp=$(ths).find('.main-button__text').html();$(ths).find('.main-button__text').html('<i class="fa fa-spinner fa-pulse"></i>');$.ajax({url:'/modules/send-fo-email.php?1',dataType:'json',data:data,method:'post',cache:false,success:function(json){if(json&&parseBool(json)===true){$(ths).find('.main-button__text').html(bkp);setOrderCongrat('congrat1',data.position);getModalNew('congrat1');}}});}}});$('#mapModal .modal-top-geo a').click(function(e){e.preventDefault();if(typeof window.myMap!=='undefined'){let coords=$(this).attr('data-coords').split('[').join('').split(']').join('').split(',');let title=$(this).parents('.modal-top-descr').find('.modal-top-tit').text();longYmapsPlacemark(coords,title);}});if($('.SBmapView').length){$('.SBmapView').click(function(e){e.preventDefault();run_map_modal(this);});}initGeoLinks();popupVideoInit();$('#videoModal').on('hide.bs.modal',function(){$('#videoModal .one-modal-slide iframe').remove();});$(window).resize(function(){setTimeout(function(){popupVideoInit();},250);});$(document).on('hidden.bs.modal',function(a){if($('.modal:visible').length>0){prevModal=a.target;}else{if(prevModal!==false&&$('.mfp-bg.mfp-ready').length===0){$(prevModal).modal('show');}prevModal=false;}});$('.delManagerPhoto').click(function(e){e.preventDefault();if(confirm('Точно удалить')){$(this).parent().find('.croper.manager img').each(function(k,item){$(this).attr('src','/upload/z.gif?'+(k+1));});$(this).addClass('d-none');$.ajax({url:'/api/catalog/userUpdate/',method:'post',data:{action:'delManagerPhoto'},dataType:'json',cache:false,success:function(data){console.log(data);}});}});});function reviewMore(modal){var rev=modal.find('.modal-com-text');if(rev.length){rev.each(function(){let text=$(this).text();let subtext='';let tmp;let strlimit=300;var mobiledetect=modal.width()<=992;if(mobiledetect){strlimit=180;}if(text.length>strlimit){tmp=text.substring(0,strlimit);subtext=text.substring(strlimit);text=tmp+'';tmp='';$(this).html(text+'<span>...</span><a href="#">Показать полностью</a><div class="d-none">'+subtext+'</div>');$(this).find('a').click(function(e){e.preventDefault();let cnt=$(this).parent();let subtext=cnt.find('.d-none').text();cnt.find('span,.d-none,a').remove();cnt.text(cnt.text()+subtext);});}});}}function popupVideoInit(){$('a.littlephotobox:not(.processed)').click(function(e){e.preventDefault();var modal=$('#lightPhotoModal');modal.find('.modal-dialog').append('<div class="loading"><span><i class="fa fa-spinner fa-pulse"></i></span></div>');modal.modal('show');var cur=this;var chref=$(cur).attr('href');if(chref==='#videoModal'){chref=$(cur).data('href');}var userid=$(cur).data('pid');var sharelink='https://wedwed.ru/catalog/item/'+userid+'/';modal.find('.one-info-bt nav.soc .fb').attr('href','https://www.facebook.com/sharer/sharer.php?u='+sharelink);modal.find('.one-info-bt nav.soc .vk').attr('href','https://vk.com/share.php?url='+sharelink);modal.find('.one-info-bt nav.soc .wa').attr('href','whatsapp://send?text='+sharelink);var group=$(cur).data('group');var cont=$(cur).parents('.imagesCont');if(cont.length===0){cont=$(cur).parents('.one-list');if(cont.length===0){cont=$(cur).parents('.pres-gall-wrap');if(cont.length===0){cont=$(cur).parents('.one-fav-slider-thumb');if(cont.length===0){cont=$(cur).parents('.reserv-block');if(cont.length===0){cont=$(cur).parents('.one-top-place-car-in');}}}}}var list=cont.find('*[data-group='+group+']');var res=[];window.slider1=modal.find('.big-modal-slider-in2');window.slider2=modal.find('.min-modal-slider-in2');if(slider1.hasClass('slick-slider')){slider1.slick('unslick');}if(slider2.hasClass('slick-slider')){slider2.slick('unslick');}slider1.html('');slider2.html('');if(list.length){for(let i=0;i<list.length;i++){var el=list.get(i);var tmp=$(el).parent().parent();if(!tmp.hasClass('slick-cloned')){res.push(el);}}}if(res&&res.length){for(let i=0;i<res.length;i++){var ths=res[i];var href=$(ths).attr('href');if(href==='#videoModal'){href=$(ths).data('href');}var dclass='';if(chref===href){dclass=' etot';}var thumb=$(ths).data('thumb')?$(ths).data('thumb'):($(ths).data('href')?$(ths).data('href'):$(ths).attr('href'));if(thumb==='#videoModal'){thumb=$(ths).data('thumb');}var title=$(ths).attr('title');if(!title){title=$(ths).find('img').attr('alt');if(!title){title='';}}slider1.append('<div class="one-modal-slide">\n\
        <div class="imgCrop">\n\
            <img src="/upload/loading.svg" alt="'+title+'" data-lazy="'+href+'">\n\
            '+(title?'<div class="one-modal-slide-caption">'+title+'</div>':'')+'\n\
        </div>\n\
    </div>');$(slider1.find('.one-modal-slide')[slider1.find('.one-modal-slide').length-1]).attr('data-href',href);slider2.append('<div class="one-min-modal-slide'+dclass+'">\n\
        <img src="'+thumb+'" alt="'+title+'" height="60">\n\
    </div>');}setTimeout(function(){slider1.off('init').on('init',function(event,slick){slider1.parent().parent().parent().find('.number-slide').text('1/'+slider1.find('.slick-slide:not(.slick-cloned)').length);}).off('beforeChange').on('beforeChange',function(event,slick,currentSlide,nextSlide){slider1.parent().parent().parent().find('.number-slide').text((nextSlide+1)+'/'+slider1.find('.slick-slide:not(.slick-cloned)').length);slider1.find('iframe').remove();slider1.find('.one-modal-slide img,.play-vid,.imgCrop').show();}).slick({dots:false,infinite:false,speed:300,slidesToShow:1,lazyLoad:'ondemand',slidesToScroll:1,arrows:true,asNavFor:'.min-modal-slider-in2'});slider2.slick({slidesToShow:res.length<10?res.length:10,slidesToScroll:1,asNavFor:'.big-modal-slider-in2',dots:false,infinite:false,arrows:false,focusOnSelect:true,height:60,responsive:[{breakpoint:1240,settings:{slidesToShow:res.length<9?res.length:9}},{breakpoint:1120,settings:{slidesToShow:res.length<7?res.length:7}},{breakpoint:915,settings:{slidesToShow:res.length<5?res.length:5}}]});setTimeout(function(){setTimeout(function(){slider2.find('.one-min-modal-slide.etot:not(.slick-cloned)').click();slider1.find('.zoom-img').click(function(){var href=$(this).parent().find('.imgCrop img').attr('src');if($('.photoZoom').length===0){$('body').append('<div class="photoZoom"><div class="photoCont" style="background-image: url(\''+href+'\');"></div><div class="photoLayer"></div><div class="photoClose"></div></div>');$('.photoZoom').hide().fadeIn().click(function(){$('.photoZoom').remove();});}else{$('.photoZoom').remove();}});},300);},500);},350);modal.find('.modal-top-tit,.modal-top-geo,.modal-comm,.modal-video-info').hide();$.ajax({url:'/api/getVideoInfo/',method:'post',dataType:'json',data:{id:userid},success:function(json){modal.find('.loading').fadeOut(300,function(){$(this).remove();});if(json&&json.status&&json.data){var data=json.data;let revhtml='';modal.find('.modal-top-tit').text(data.title?data.title:'').fadeIn();if(data.address){modal.find('.modal-top-geo a').text(data.address);modal.find('.modal-top-geo').css({display:'table'});}modal.find('.orderBtn,.sborderBtn,.callBtn,.sbshowCont,.modal-top-geo a').attr('data-name',data.title).data('name',data.title).attr('data-links','').data('links','').attr('data-mname',data.mnane).data('mname',data.mnane).attr('data-auth',data.auth?'true':'false').data('auth',data.auth?'true':'false').attr('data-place',data.place?'true':'false').data('place',data.place?'true':'false').attr('data-id',data.id).attr('data-phone',data.phone).data('id',data.id).attr('data-phone',data.phone).attr('data-ocount',data.obcount).data('ocount',data.obcount).attr('data-manager',data.manager).data('manager',data.manager).attr('data-title',data.title).data('title',data.title).attr('data-address',data.address).data('address',data.address).attr('data-coords',data.lat&&data.lng?'['+data.lat+','+data.lng+']':'').data('coords',data.lat&&data.lng?'['+data.lat+','+data.lng+']':'').attr('data-logo',data.logo).data('logo',data.logo);modal.find('.modal-video-info').fadeIn();modal.find('.modal-top-thumb img').attr('src',data.logo);modal.find('.all-modal-comm').html(data.reviewword);modal.find('.one-info-bt a.heartlink').attr('class','heartlink heartlink'+userid+' ajax-fav soc'+(data.inFav?' active':'')).attr('href','/catalog/?id='+userid+'&action='+(data.inFav?'delete':'add')+'&table=wishlist');if(data.review&&data.review.length>0){for(let i=0;i<data.review.length;i++){var rev=data.review[i];revhtml=revhtml+'<div class="one-modal-comm">'+'<div class="modal-com-avat">'+'<img src="'+rev.ava+'" alt="">'+'</div>'+'<div class="modal-com-descr">'+'<div class="modal-com-top">'+'<div class="modal-com-name">'+rev.name+'</div>'+'<div class="modal-com-date">'+rev.date+'</div>'+'</div>'+'<div class="modal-com-text">'+rev.text.replace(/\\n/g,'<br>')+'</div>'+'</div>'+'</div>';}modal.find('.modal-comm-wrap').html(revhtml);modal.find('.modal-comm').fadeIn();reviewMore(modal);}}else{console.log('Что-то пошло не так...');}}});}}).addClass('processed');$('.js-card-gallery a.img-wrapper,a.photobox').unbind('click').click(function(e){e.preventDefault();var modal=$('#videoModal');modal.find('.modal-dialog').append('<div class="loading"><span><i class="fa fa-spinner fa-pulse"></i></span></div>');modal.modal('show');var cur=this;var chref=$(cur).attr('href');if(chref==='#videoModal'){chref=$(cur).data('href');}var userid=$(cur).data('pid');var sharelink='https://wedwed.ru/catalog/item/'+userid+'/';modal.find('.one-info-bt nav.soc .fb').attr('href','https://www.facebook.com/sharer/sharer.php?u='+sharelink);modal.find('.one-info-bt nav.soc .vk').attr('href','https://vk.com/share.php?url='+sharelink);modal.find('.one-info-bt nav.soc .wa').attr('href','whatsapp://send?text='+sharelink);var group=$(cur).data('group');var cont=$(cur).parents('.imagesCont');if(cont.length===0){cont=$(cur).parents('.one-list');if(cont.length===0){cont=$(cur).parents('.pres-gall-wrap');if(cont.length===0){cont=$(cur).parents('.one-fav-slider-thumb');if(cont.length===0){cont=$(cur).parents('.reserv-block');if(cont.length===0){cont=$(cur).parents('.one-top-place-car-in');if(cont.length===0){cont=$(cur).parents('.catalog-card__item');}}}}}}var list=cont.find('*[data-group='+group+']');var res=[];window.slider1=modal.find('.big-modal-slider-in');window.slider2=modal.find('.min-modal-slider-in');if(slider1.hasClass('slick-slider')){slider1.slick('unslick');}if(slider2.hasClass('slick-slider')){slider2.slick('unslick');}slider1.html('');slider2.html('');if(list.length){for(let i=0;i<list.length;i++){var el=list.get(i);var tmp=$(el).parent().parent();if(!tmp.hasClass('slick-cloned')){res.push(el);}}}if(res&&res.length){for(let i=0;i<res.length;i++){var ths=res[i];var href=$(ths).attr('href');if(href==='#videoModal'){href=$(ths).data('href');}var dclass='';if(chref===href){dclass=' etot';}var thumb=$(ths).data('thumb')?$(ths).data('thumb'):($(ths).data('href')?$(ths).data('href'):$(ths).attr('href'));if(thumb==='#videoModal'){thumb=$(ths).data('thumb');}var title=$(ths).attr('title');if(!title){title=$(ths).find('img').attr('alt');if(!title){title='';}}slider1.append('<div class="one-modal-slide">\n\
        <div class="imgCrop">\n\
            <img src="/upload/loading.svg" alt="'+title+'" data-lazy="'+href+'">\n\
            '+(title?'<div class="one-modal-slide-caption">'+title+'</div>':'')+'\n\
        </div>\n\
    </div>');$(slider1.find('.one-modal-slide')[slider1.find('.one-modal-slide').length-1]).attr('data-href',href);slider2.append('<div class="one-min-modal-slide'+dclass+'">\n\
        <img src="'+thumb+'" alt="'+title+'" height="60">\n\
    </div>');}setTimeout(function(){slider1.off('init').on('init',function(event,slick){slider1.parent().parent().parent().find('.number-slide').text('1/'+slider1.find('.slick-slide:not(.slick-cloned)').length);}).off('beforeChange').on('beforeChange',function(event,slick,currentSlide,nextSlide){slider1.parent().parent().parent().find('.number-slide').text((nextSlide+1)+'/'+slider1.find('.slick-slide:not(.slick-cloned)').length);slider1.find('iframe').remove();slider1.find('.one-modal-slide img,.play-vid,.imgCrop').show();}).slick({dots:false,infinite:false,speed:300,slidesToShow:1,lazyLoad:'ondemand',slidesToScroll:1,arrows:true,asNavFor:'.min-modal-slider-in'});slider2.slick({slidesToShow:res.length<10?res.length:10,slidesToScroll:1,asNavFor:'.big-modal-slider-in',dots:false,infinite:false,arrows:false,focusOnSelect:true,height:60,responsive:[{breakpoint:1240,settings:{slidesToShow:res.length<9?res.length:9}},{breakpoint:1120,settings:{slidesToShow:res.length<7?res.length:7}},{breakpoint:915,settings:{slidesToShow:res.length<5?res.length:5}}]});setTimeout(function(){setTimeout(function(){slider2.find('.one-min-modal-slide.etot:not(.slick-cloned)').click();slider1.find('.zoom-img').click(function(){var href=$(this).parent().find('.imgCrop img').attr('src');if($('.photoZoom').length===0){$('body').append('<div class="photoZoom"><div class="photoCont" style="background-image: url(\''+href+'\');"></div><div class="photoLayer"></div><div class="photoClose"></div></div>');$('.photoZoom').hide().fadeIn().click(function(){$('.photoZoom').remove();});}else{$('.photoZoom').remove();}});},300);},500);},350);modal.find('.modal-top-tit,.modal-top-geo,.modal-comm,.modal-video-info').hide();$.ajax({url:'/api/getVideoInfo/',method:'post',dataType:'json',data:{id:userid},success:function(json){modal.find('.loading').fadeOut(300,function(){$(this).remove();});if(json&&json.status&&json.data){var data=json.data;let revhtml='';modal.find('.modal-top-tit').text(data.title?data.title:'').fadeIn();if(data.address){modal.find('.modal-top-geo a').text(data.address);modal.find('.modal-top-geo').css({display:'table'});}modal.find('.orderBtn,.sborderBtn,.callBtn,.sbshowCont,.modal-top-geo a').attr('data-name',data.title).data('name',data.title).attr('data-links','').data('links','').attr('data-mname',data.mnane).data('mname',data.mnane).attr('data-auth',data.auth?'true':'false').data('auth',data.auth?'true':'false').attr('data-place',data.place?'true':'false').data('place',data.place?'true':'false').attr('data-id',data.id).attr('data-phone',data.phone).data('id',data.id).attr('data-phone',data.phone).attr('data-ocount',data.obcount).data('ocount',data.obcount).attr('data-manager',data.manager).data('manager',data.manager).attr('data-title',data.title).data('title',data.title).attr('data-address',data.address).data('address',data.address).attr('data-coords',data.lat&&data.lng?'['+data.lat+','+data.lng+']':'').data('coords',data.lat&&data.lng?'['+data.lat+','+data.lng+']':'').attr('data-logo',data.logo).data('logo',data.logo);modal.find('.modal-video-info').fadeIn();modal.find('.modal-top-thumb img').attr('src',data.logo);modal.find('.all-modal-comm').html(data.reviewword);modal.find('.one-info-bt a.heartlink').attr('class','heartlink heartlink'+userid+' ajax-fav soc'+(data.inFav?' active':'')).attr('href','/catalog/?id='+userid+'&action='+(data.inFav?'delete':'add')+'&table=wishlist');if(data.review&&data.review.length>0){for(let i=0;i<data.review.length;i++){var rev=data.review[i];revhtml=revhtml+'<div class="one-modal-comm">'+'<div class="modal-com-avat">'+'<img src="'+rev.ava+'" alt="">'+'</div>'+'<div class="modal-com-descr">'+'<div class="modal-com-top">'+'<div class="modal-com-name">'+rev.name+'</div>'+'<div class="modal-com-date">'+rev.date+'</div>'+'</div>'+'<div class="modal-com-text">'+rev.text.replace(/\\n/g,'<br>')+'</div>'+'</div>'+'</div>';}modal.find('.modal-comm-wrap').html(revhtml);modal.find('.modal-comm').fadeIn();reviewMore(modal);}}else{console.log('Что-то пошло не так...');}}});}});$('.popupbox-video:not(.processed)').click(function(e){e.preventDefault();var modal=$('#videoModal');modal.find('.modal-dialog').append('<div class="loading"><span><i class="fa fa-spinner fa-pulse"></i></span></div>');var mobiledetect=modal.width()<=992;var cur=this;var chref=$(cur).data('href');var userid=$(cur).data('pid');var sharelink='https://wedwed.ru/catalog/item/'+userid+'/';modal.find('.one-info-bt nav.soc .fb').attr('href','https://www.facebook.com/sharer/sharer.php?u='+sharelink);modal.find('.one-info-bt nav.soc .vk').attr('href','https://vk.com/share.php?url='+sharelink);modal.find('.one-info-bt nav.soc .wa').attr('href','whatsapp://send?text='+sharelink);var group=$(cur).data('group');var cont=$(cur).parent().parent().parent().parent().parent();var list=cont.find('*[data-group='+group+']');var res=[];window.slider1=modal.find('.big-modal-slider-in');window.slider2=modal.find('.min-modal-slider-in');if(slider1.hasClass('slick-slider')){slider1.slick('unslick');}if(slider2.hasClass('slick-slider')){slider2.slick('unslick');}slider1.html('');slider2.html('');if(list.length){for(let i=0;i<list.length;i++){var el=list.get(i);var tmp=$(el).parent().parent().parent().parent();if(!tmp.hasClass('slick-cloned')){res.push(el);}}}if(res&&res.length){for(let i=0;i<res.length;i++){var ths=res[i];var href=$(ths).data('href');var dclass='';if(chref===href){dclass=' etot';}var thumb=$(ths).data('thumb');slider1.append('<div class="one-modal-slide">\n\
    <div class="play-vid"></div>\n\
    <div class="imgCrop">\n\
            <img src="'+thumb+'" alt="">\n\
    </div>\n\
    </div>');$(slider1.find('.one-modal-slide')[slider1.find('.one-modal-slide').length-1]).attr('data-href',href);slider2.append('<div class="one-min-modal-slide'+dclass+'">\n\
        <img src="'+thumb+'" alt="" height="60">\n\
    </div>');}setTimeout(function(){slider1.off('init').on('init',function(event,slick){slider1.parent().parent().parent().find('.number-slide').text('1/'+slider1.find('.slick-slide:not(.slick-cloned)').length);}).off('beforeChange').on('beforeChange',function(event,slick,currentSlide,nextSlide){slider1.parent().parent().parent().find('.number-slide').text((nextSlide+1)+'/'+slider1.find('.slick-slide:not(.slick-cloned)').length);slider1.find('iframe').remove();slider1.find('.one-modal-slide img,.play-vid,.imgCrop').show();}).slick({dots:false,infinite:false,speed:300,slidesToShow:1,slidesToScroll:1,arrows:true,asNavFor:'.min-modal-slider-in'});slider2.slick({slidesToShow:res.length<6?res.length:6,slidesToScroll:1,asNavFor:'.big-modal-slider-in',dots:false,arrows:false,infinite:false,focusOnSelect:true,height:60,responsive:[{breakpoint:1240,settings:{slidesToShow:res.length<9?res.length:9}},{breakpoint:1120,settings:{slidesToShow:res.length<7?res.length:7}},{breakpoint:915,settings:{slidesToShow:res.length<5?res.length:5}}]});setTimeout(function(){setTimeout(function(){slider2.find('.one-min-modal-slide.etot:not(.slick-cloned)').click();slider1.find('.play-vid').click(function(){$(this).hide();$(this).parents('.one-modal-slide').find('img').hide();$(this).parents('.one-modal-slide').find('.imgCrop').hide();var height=$(this).parents('.one-modal-slide').find('img').height();if(!height){height=$(this).parents('.one-modal-slide').find('.imgCrop').height();}var ythref=matchYoutubeUrl($(this).parents('.one-modal-slide').data('href'));var vmhref=matchVimeoUrl($(this).parents('.one-modal-slide').data('href'));var iframe='';if(ythref){iframe='<iframe id="ytplayer" type="text/html" width="100%" height="'+parseInt(height)+'" src="https://www.youtube.com/embed/'+ythref+'?autoplay=1&origin='+window.location.origin+'" frameborder="0"/>';$(this).parents('.one-modal-slide').append(iframe);}else if(vmhref){iframe='<iframe src="https://player.vimeo.com/video/'+vmhref+'?autoplay=1&color=ffffff&title=0&byline=0&portrait=0" style="background: #FFF;" width="100%" height="'+parseInt(height)+'" allow="autoplay; fullscreen" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen />';$(this).parents('.one-modal-slide').append(iframe);}else{$(this).show();$(this).parents('.one-modal-slide').find('img').show();}});},300);},500);},350);modal.find('.modal-top-tit,.modal-top-geo,.modal-comm,.modal-video-info').hide();$.ajax({url:'/api/getVideoInfo/',method:'post',dataType:'json',data:{id:userid},success:function(json){modal.find('.loading').fadeOut(300,function(){$(this).remove();});if(json&&json.status&&json.data){var data=json.data;let revhtml='';modal.find('.modal-top-tit').text(data.title?data.title:'').fadeIn();if(data.address){modal.find('.modal-top-geo a').text(data.address);modal.find('.modal-top-geo').fadeIn();}modal.find('.orderBtn,.sborderBtn,.callBtn,.sbshowCont,.modal-top-geo a').attr('data-name',data.title).data('name',data.title).attr('data-links','').data('links','').attr('data-mname',data.name).data('mname',data.name).attr('data-auth',data.auth?'true':'false').data('auth',data.auth?'true':'false').attr('data-place',data.place?'true':'false').data('place',data.place?'true':'false').attr('data-id',data.id).data('id',data.id).attr('data-phone',data.phone).data('phone',data.phone).attr('data-ocount',data.obcount).data('ocount',data.obcount).attr('data-manager',data.manager).data('manager',data.manager).attr('data-title',data.title).data('title',data.title).attr('data-address',data.address).data('address',data.address).attr('data-coords',data.lat&&data.lng?'['+data.lat+','+data.lng+']':'').data('coords',data.lat&&data.lng?'['+data.lat+','+data.lng+']':'').attr('data-logo',data.logo).data('logo',data.logo);modal.find('.modal-video-info').fadeIn();modal.find('.modal-top-thumb img').attr('src',data.logo);modal.find('.all-modal-comm').html(data.reviewword);modal.find('.one-info-bt a.heartlink').attr('class','heartlink heartlink'+userid+' ajax-fav soc'+(data.inFav?' active':'')).attr('href','/catalog/?id='+userid+'&action='+(data.inFav?'delete':'add')+'&table=wishlist');if(data.review&&data.review.length>0){for(let i=0;i<data.review.length;i++){var rev=data.review[i];revhtml=revhtml+'<div class="one-modal-comm">'+'<div class="modal-com-avat">'+'<img src="'+rev.ava+'" alt="">'+'</div>'+'<div class="modal-com-descr">'+'<div class="modal-com-top">'+'<div class="modal-com-name">'+rev.name+'</div>'+'<div class="modal-com-date">'+rev.date+'</div>'+'</div>'+'<div class="modal-com-text">'+rev.text.replace(/\\n/g,'<br>')+'</div>'+'</div>'+'</div>';}modal.find('.modal-comm-wrap').html(revhtml);modal.find('.modal-comm').fadeIn();reviewMore(modal);}}else{console.log('Что-то пошло не так...');}}});}}).addClass('processed');}function initGeoLinks(){$('.viewonmap:not(.processed),.mob-map-bt a:not(.processed),.SBmodalMapPrepare:not(.processed)').click(function(e){e.preventDefault();let title=$(this).data('title');var id=$(this).data('id');let address=$(this).data('address');let logo=$(this).data('logo');let coords=$(this).attr('data-coords');$(".modal").modal("hide");if($('#leftmap').length&&id===0){if(ismob){$('.side-map').fadeIn();}$('.viewonmap').hide();$('.hide-map').fadeIn();$('.sidebar').addClass('open');$('.content-wrap').addClass('shown-map');setTimeout(function(){SlyReload();},500);if(leftMap!==false){loadPlaces(leftMap,id);}else{ymaps.ready(function(){leftMap=new ymaps.Map('leftmap',{center:ccoo,zoom:12,controls:[]},{searchControlProvider:'yandex#search'});if(!ismob){var fullscreenControl=new ymaps.control.FullscreenControl({options:{float:'left'}});leftMap.controls.add(fullscreenControl);}var zoomControl=new ymaps.control.ZoomControl();leftMap.controls.add(zoomControl);MyBalloonLayout=ymaps.templateLayoutFactory.createClass('<div class="popover top sb-popover">'+'<a class="close" href="#">&times;</a>'+'<div class="arrow"></div>'+'<div class="popover-inner">'+'$[[options.contentLayout observeSize minWidth=284 maxWidth=284 minHeight=268]]'+'</div>'+'</div>',{build:function(){this.constructor.superclass.build.call(this);this._$element=$('.popover',this.getParentElement());this.applyElementOffset();this._$element.find('.close').on('click',$.proxy(this.onCloseClick,this));},clear:function(){this._$element.find('.close').off('click');this.constructor.superclass.clear.call(this);},onSublayoutSizeChange:function(){MyBalloonLayout.superclass.onSublayoutSizeChange.apply(this,arguments);if(!this._isElement(this._$element)){return;}this.applyElementOffset();this.events.fire('shapechange');},applyElementOffset:function(){this._$element.css({left:-(this._$element[0].offsetWidth/2),top:-(this._$element[0].offsetHeight+this._$element.find('.arrow')[0].offsetHeight)});},onCloseClick:function(e){e.preventDefault();this.events.fire('userclose');},getShape:function(){if(!this._isElement(this._$element)){return MyBalloonLayout.superclass.getShape.call(this);}var position=this._$element.position();return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[position.left,position.top],[position.left+this._$element[0].offsetWidth,position.top+this._$element[0].offsetHeight+this._$element.find('.arrow')[0].offsetHeight]]));},_isElement:function(element){return element&&element[0]&&element.find('.arrow')[0];}});MyBalloonContentLayout=ymaps.templateLayoutFactory.createClass('<div class="popover-image" style="background-image: url(\'$[properties.balloonImage]\')"></div>'+'<div class="popover-logo" style="background-image: url(\'$[properties.balloonLogo]\')"></div>'+'<a href="$[properties.balloonLink]" target="_blank"><h3 class="popover-title">$[properties.balloonHeader]</h3></a>'+'<div class="popover-address">$[properties.balloonAddress]</div>'+'<div class="popover-content">$[properties.balloonContent]</div>');loadPlaces(leftMap,id);});}}else{var moda=$('#mapModal');moda.find('.modal-top-tit').html(title);moda.find('.modal-top-thumb img').attr('src',logo);moda.find('.modal-top-geo a').html(address).attr('data-coords',coords);moda.find('.orderBtn,.sborderBtn,.callBtn,.sbshowCont').attr('data-auth',$(this).attr('data-auth')).data('auth',$(this).attr('data-auth')).attr('data-place',$(this).attr('data-place')).data('place',$(this).attr('data-place')).attr('data-name',$(this).attr('data-name')).data('name',$(this).attr('data-name')).attr('data-logo',$(this).attr('data-logo')).data('logo',$(this).attr('data-logo')).attr('data-id',$(this).attr('data-id')).data('id',$(this).attr('data-id')).attr('data-phone',$(this).attr('data-phone')).data('phone',$(this).attr('data-phone')).attr('data-insta',$(this).attr('data-insta')).data('insta',$(this).attr('data-insta')).attr('data-tarif',$(this).attr('data-tarif')).data('tarif',$(this).attr('data-tarif')).attr('data-links',$(this).attr('data-links')).data('links',$(this).attr('data-links')).attr('data-mname',$(this).attr('data-mname')).data('mname',$(this).attr('data-mname')).attr('data-ocount',$(this).attr('data-ocount')).data('ocount',$(this).attr('data-ocount')).attr('data-manager',$(this).attr('data-manager')).data('manager',$(this).attr('data-manager'));$('#mapModal .modal-top-geo a').click();if($(this).parent().hasClass('one-place-on-map')){$('#mapModal').modal('show');}}}).addClass('processed');}function run_map_modal(){SBmapShow();}function SBmapShow(){$('#mapModal').modal('show');}function init_formbuttons(){$('.more-info-show:not(.processed)').unbind('click').click(function(e){e.preventDefault();var data={status:'noSuccessCall'};$.ajax({url:'/api/contactStatus/',method:'post',dataType:'json',data:data,success:function(data){if(data&&data.status){window.lastCall=data.data;}}});$(this).parent().find('.more-info').slideDown().find('textarea').val('');}).addClass('processed');$('.nosuccessBtn:not(.processed)').unbind('click').click(function(e){e.preventDefault();if(window.lastCall){var data={status:'noSuccessCall',id:parseInt(window.lastCall),comment:$(this).parent().find('.more-info-field').val()};window.lastCall=false;$.ajax({url:'/api/contactStatus/',method:'post',dataType:'json',data:data,success:function(data){if(data&&data.status){}}});}$('.modal:visible').each(function(){$(this).modal('hide');});}).addClass('processed');$('.successBtn:not(.processed)').unbind('click').click(function(e){e.preventDefault();var data={status:'successCall'};$.ajax({url:'/api/contactStatus/',method:'post',dataType:'json',data:data,success:function(data){if(data&&data.status){console.log(data.status);}}});$('.modal:visible').each(function(){$(this).modal('hide');});setTimeout(function(){setOrderCongrat('congrat1','success');getModalNew('congrat1');},50);}).addClass('processed');$('.sub-close:not(.processed)').unbind('click').click(function(e){e.preventDefault();$(this).parent().hide();}).addClass('processed');}function process_form(link,win){let form=win.find('form');form.find('input[type=hidden]').each(function(){$(this).remove();});if(link.data('links')){let links=decodeURIComponent(link.data('links'));win.find('.replace_links').html(links);}else{win.find('.replace_links').html('');}if(link.data('btntext')){win.find('.replace-btntext').html(link.data('btntext'));}else{if(link.data('place')!==undefined){if(link.data('place')){win.find('.replace-btntext').html('Отправить запрос');}else{win.find('.replace-btntext').html('Отправить запрос');}}else{win.find('.replace-btntext').html('Отправить');}}if(link.data('subject')){if($('#'+link.data('subject')).length){win.find('.popup-text').html($('#'+link.data('subject')).html()).css({display:'block'});}else{win.find('.popup-text').html('').css({display:'none'});}}else{win.find('.popup-text').html('').css({display:'none'});}if(link.data('name')){win.find('.replace-name').html(link.data('name'));if(form.find('input[name=name]').length===0){form.append('<input name="name" type="hidden" />');}form.find('input[name=name]').val(link.data('name'));}else{win.find('.replace-name').html('');}if(link.data('mname')){win.find('.replace-mname').html(link.data('mname'));}else{win.find('.replace-mname').html('');}if(link.data('ocount')){win.find('.replace-ocount').html(link.data('ocount'));}else{win.find('.replace-ocount').html('');}if(link.data('phone')){win.find('.replace-phone').html(format_phone(link.data('phone'))).attr('href','tel:'+tel_phone(link.data('phone')));}else{win.find('.replace-phone').html('');}if((link.data('place')===undefined||!link.data('place'))&&win.find('.replace-insta').length){if(link.data('insta')&&link.data('tarif')&&link.data('tarif')>1){win.find('.replace-insta').html('@'+link.data('insta')).attr('href','https://instagram.com/'+link.data('insta')+'/').parent().show();}else{win.find('.replace-insta').hide().html('').parent().hide();}}else{win.find('.replace-insta').hide().html('').parent().hide();}if(link.data('auth')!==undefined){if(link.data('auth')){win.find('.if-auth').show();win.find('.if-noauth').hide();}else{if(link.data('place')===false){win.find('.if-auth').hide();win.find('.if-noauth').show();}else{if(link.data('place')===true){win.find('.if-auth').show();win.find('.if-noauth').hide();}else{win.find('.if-noauth,.if-auth').hide();}}}}if(link.data('place')!==undefined){if(link.data('place')&&link.data('place')===true){win.find('form').removeClass('forgtm-isFace').addClass('forgtm-isPlace');}else{win.find('form').removeClass('forgtm-isPlace').addClass('forgtm-isFace');}if(link.data('place')){win.find('.for-place').show();win.find('.for-service').hide();}else{if(link.data('place')===true){win.find('.for-place').hide();win.find('.for-service').show();}else{win.find('.for-place,.for-service').hide();}}}if(link.data('logo')){win.find('.replace-logo').css({'background-image':'url('+link.data('logo')+')'});if(form.find('input[name=logo]').length===0){form.append('<input name="logo" type="hidden" />');}form.find('input[name=logo]').val(link.data('logo'));}if(link.data('manager')){if(link.data('manager')==='none'){win.find('.replace-manager1').css({'background-image':'url(/upload/z.gif)'});win.find('.replace-manager2').css({'background-image':'url(/upload/z.gif)'});win.find('.replace-manager3').css({'background-image':'url(/upload/z.gif)'});win.find('.replace-manager4').css({'background-image':'url(/upload/z.gif)'});}else{win.find('.replace-manager1').css({'background-image':'url('+link.data('manager')+'_1)'});win.find('.replace-manager2').css({'background-image':'url('+link.data('manager')+'_2)'});win.find('.replace-manager3').css({'background-image':'url('+link.data('manager')+'_3)'});win.find('.replace-manager4').css({'background-image':'url('+link.data('manager')+'_4)'});}if(form.find('input[name=manager]').length===0){form.append('<input name="manager" type="hidden" />');}form.find('input[name=manager]').val(link.data('manager'));}if(form.length){if(link.data('id')){if(form.find('input[name=user_id]').length===0){form.append('<input name="user_id" type="hidden" />');}form.find('input[name=user_id]').val(link.data('id'));}if(link.data('place')!==undefined){if(form.find('input[name=place]').length===0){form.append('<input name="position" type="hidden" />');}form.find('input[name=position]').val(link.data('place')===true?'from-catalog-item-banket':(link.data('place')===false?'from-catalog-item':'from-catalog-left'));}if(link.data('action')){form.attr('data-action',link.data('action'));}else{form.attr('data-action','');}}if(win.find('.orderBtn').length){win.find('.orderBtn').each(function(k,btn){let dt=link.data();for(var key in dt){$(btn).attr('data-'+key,dt[key]);}});}}function transferData(f1,f2){var form=f2.find('form');if(form.length>0){form.removeClass('forgtm-isPlace').removeClass('forgtm-isFace');if(f1.hasClass('forgtm-isPlace')){form.addClass('forgtm-isPlace');}if(f1.hasClass('forgtm-isFace')){form.addClass('forgtm-isFace');}f2.find('input[type=hidden]').each(function(){$(this).remove();});let data=f1.serializeArray();if(data.length){for(let l=0;l<data.length;l++){if(form.find(data[l].name).length===0){if(data[l].name==='logo'){f2.find('.replace-logo').css({'background-image':'url('+data[l].value+')'});}else{if(data[l].name==='name'){f2.find('.replace-name').html(data[l].value);}else{form.append('<input name="'+data[l].name+'" type="hidden" value="'+data[l].value+'">');}}}else{form.find(data[l].name).val(data[l].value);}}}}}function validate_form(form){var errors=0,err,phonetest=/\+7 \d{3} \d{3} \d{2} \d{2}/g,emtest=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$(form).find('.required').each(function(k,el){err=false;if(el.type==='email'){if(!emtest.test($(el).val())){err=true;errors++;}else{$(el).unbind('keyup').unbind('change').removeClass('error');}}else{if(el.type==='tel'){if(!phonetest.test($(el).val())){err=true;errors++;}else{$(el).unbind('keyup').unbind('change').removeClass('error');}}else{if(!$(el).val()||$(el).val()==='00.00.0000'){err=true;errors++;}else{$(el).unbind('keyup').unbind('change').removeClass('error');}}}if(err){$(el).addClass('error').bind('keyup change',function(){$(this).unbind('keyup change').removeClass('error');}).change(function(){$(this).unbind('keyup change').removeClass('error');});}});return errors>0?false:true;}function jeb(val){console.log(val);}function setOrderCongrat(selector,position){let title='Спасибо! Ваш запрос успешно отправлен.',text='В ближайшее время мы свяжемся с Вами для уточнения критериев!';switch(position){case'invFeedSuccess':title='Спасибо за отзыв!';text='После проверки модератором мы его обязательно опубликуем!';break;case'from-catalog-item':title='Спасибо! Ваш запрос отправлен исполнителю.';text='В ближайшее время он свяжется с Вами!';break;case'from-catalog-item-banket':title='Спасибо! Ваш запрос отправлен площадке.';text='В ближайшее время банкетный менеджер свяжется с Вами!';break;case'from-catalog-left':title='Спасибо! Ваш запрос отправлен.';text='В ближайшее время менеджер свяжется с Вами для уточнения ваших пожеланий!';break;case'success':title='Ну и хорошо!';text='Продолжайте в том же духе и сэкономите еще больше!';break;}$('#'+selector+' .modal_title').html(title);$('#'+selector+' .modal_message').html(text);}function convertToObject(data){if(data.length){var obj={};for(let l=0;l<data.length;l++){if(data[l].name&&data[l].value){obj[data[l].name]=data[l].value;}}return obj;}else{return data;}}function scrollTo(selector){if($(selector).length){$('html, body').stop().animate({scrollTop:$(selector).offset().top-$('#lodingHeader').height()},500);}}var uploadqueue=[],uploadphqueue=[],file_loader_timer=false,photo_loader_timer=false,files_in_progress=0,photos_in_progress=0;function add_pinfile_to_queue(file){var data=new FormData;var reader=new FileReader();reader.onload=function(event){var block=reader.result.split(";");var contentType=block[0].split(":")[1];var realData=block[1].split(",")[1];var blob=base64ToBlob(realData,contentType);data.append("image",blob,"image");uploadqueue[uploadqueue.length]={form:data,filename:file.file.name+''};wait_file_pinqueue();};reader.file=file.file;reader.readAsDataURL(file.file);}function add_photofile_to_queue(file){var data=new FormData;var reader=new FileReader();reader.onload=function(event){var block=reader.result.split(";");var contentType=block[0].split(":")[1];var realData=block[1].split(",")[1];var blob=base64ToBlob(realData,contentType);data.append("image",blob,"image");uploadphqueue[uploadphqueue.length]={form:data,filename:file.file.name+''};wait_file_photoqueue();};reader.file=file.file;reader.readAsDataURL(file.file);}function uid_file(){var idstr=String.fromCharCode(Math.floor((Math.random()*25)+65));do{var ascicode=Math.floor((Math.random()*42)+48);if(ascicode<58||ascicode>64){idstr+=String.fromCharCode(ascicode);}}while(idstr.length<32);return(idstr);}function wait_file_pinqueue(){if(file_loader_timer){clearTimeout(file_loader_timer);}$('#loader_in_progress').stop().fadeIn(200);file_loader_timer=setInterval(function(){var current;if(uploadqueue.length===0&&files_in_progress===0){$('#loader_in_progress').stop().fadeOut(200);clearTimeout(file_loader_timer);}if(uploadqueue.length>0&&files_in_progress<5){files_in_progress++;var formData=uploadqueue[uploadqueue.length-1].form;var color=uploadqueue[uploadqueue.length-1].color;var filename=uploadqueue[uploadqueue.length-1].filename;uploadqueue.splice(uploadqueue.length-1,1);var uid=uid_file();var prog=$('#loader_in_progress');prog.append('<div id="'+uid+'" class="row">'+'<div class="col-md-8">'+filename+'</div>'+'<div class="col-md-1">&nbsp;</div>'+'<div class="col-md-3">'+'<div class="progress" style="height: 7px;margin-top: 7px;">'+'<div id="bar'+uid+'" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>'+'</div>'+'</div>'+'</div>');var progressBar=$('#bar'+uid).get(0);var el=$('#'+uid).get(0);$.ajax({url:'/api/loadNewPin/',type:'post',contentType:false,processData:false,data:formData,dataType:'json',xhr:function(){var xhr=$.ajaxSettings.xhr();xhr.upload.addEventListener('progress',function(evt){if(evt.lengthComputable){var percentComplete=Math.ceil(evt.loaded/evt.total*100);$(progressBar).css({width:parseInt(percentComplete)+'%'}).attr('aria-valuenow',parseInt(percentComplete));}},false);return xhr;},error:function(){files_in_progress--;el.remove();},success:function(data){files_in_progress--;el.remove();if(data&&data.status){$('#pinList').prepend('<div class="idea-item">'+'<div class="idea-image"><img src="'+data.url+'"></div>'+'<div class="idea-name" data-id="'+data.id+'"></div>'+'<a class="edit-idea" href="" data-id="'+data.id+'"><i class="fa fa-pencil" aria-hidden="true"></i></a>'+'<a class="del-idea" href="" data-id="'+data.id+'"><i class="fa fa-times" aria-hidden="true"></i></a>'+'</div>');initIdeaControl();}}});}},100);}function wait_file_photoqueue(){if(photo_loader_timer){clearTimeout(photo_loader_timer);}$('#loader_in_progress').stop().fadeIn(200);photo_loader_timer=setInterval(function(){var current;if(uploadphqueue.length===0&&photos_in_progress===0){$('#loader_in_progress').stop().fadeOut(200);clearTimeout(photo_loader_timer);}if(uploadphqueue.length>0&&photos_in_progress<5){photos_in_progress++;var formData=uploadphqueue[uploadphqueue.length-1].form;var color=uploadphqueue[uploadphqueue.length-1].color;var filename=uploadphqueue[uploadphqueue.length-1].filename;uploadphqueue.splice(uploadphqueue.length-1,1);var uid=uid_file();var prog=$('#loader_in_progress');prog.append('<div id="'+uid+'" class="row">'+'<div class="col-md-8">'+filename+'</div>'+'<div class="col-md-1">&nbsp;</div>'+'<div class="col-md-3">'+'<div class="progress" style="height: 7px;margin-top: 7px;">'+'<div id="bar'+uid+'" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>'+'</div>'+'</div>'+'</div>');var progressBar=$('#bar'+uid).get(0);var el=$('#'+uid).get(0);$.ajax({url:'/api/loadNewPhoto/',type:'post',contentType:false,processData:false,data:formData,dataType:'json',xhr:function(){var xhr=$.ajaxSettings.xhr();xhr.upload.addEventListener('progress',function(evt){if(evt.lengthComputable){var percentComplete=Math.ceil(evt.loaded/evt.total*100);$(progressBar).css({width:parseInt(percentComplete)+'%'}).attr('aria-valuenow',parseInt(percentComplete));}},false);return xhr;},error:function(){photos_in_progress--;el.remove();},success:function(data){photos_in_progress--;el.remove();if(data&&data.status){$('#loadFastPhoto').parent().find('ul').append('<li title="image" data-id="'+data.id+'" class="ui-sortable-handle">'+'<img src="'+data.url+'" alt="photo" width="105"><br>'+'<label><input type="checkbox" name="deletePhoto[]" value="'+data.id+'">удалить</label></li>');$('ul.sortable-images').sortable('destroy').sortable({update:function(event,ui){let ids=[];$('ul.sortable-images li').each(function(k,item){ids[k]=$(item).data('id');});$('ul.sortable-images').append('<div class="sort-loader"><i class="fa fa-spinner fa-pulse fa-fw"></i></div>');$('.sort-loader').css({display:'none'}).fadeIn();$.ajax({'url':'/api/updatePhSort/','method':'post','data':{'ids':ids.join(',')},'dataType':'json','success':function(json){if(json.status){$('.sort-loader').stop().fadeOut(300,function(){$(this).remove();});}}});}});initIdeaControl();}}});}},100);}$(function(){$('#loadFastPhoto').click(function(){$(this).parent().find('input[type=file]').click();});$('.servPhotosLoad input[type=file]').change(function(e){e.preventDefault();let file;var ths=this;var handler=$(this).parents('.pinLoader').get(0);var type=$(this).data('type');if(this.files.length){for(let i=0;i<this.files.length;i++){file=this.files[i];if(file.type==="image/jpeg"||file.type==="image/png"){add_photofile_to_queue({file:file});}}something_happens($(this));}});$('.pinLoader input[type=file]').change(function(e){e.preventDefault();let file;var ths=this;var handler=$(this).parents('.pinLoader').get(0);var type=$(this).data('type');if(this.files.length){for(let i=0;i<this.files.length;i++){file=this.files[i];if(file.type==="image/jpeg"||file.type==="image/png"){add_pinfile_to_queue({file:file});}}something_happens($(this));}});$('.delFiltInv').click(function(e){e.preventDefault();var ths=this;$('#FindInvForm input.name'+$(this).data('name')).each(function(){if($(this).attr('value')===$(ths).data('val')){$(this).parents('label').click();}});});if($('#Idea').length){$('.delFilt').click(function(e){e.preventDefault();var ths=this;$('#FindIdeaForm input.name'+$(this).data('name')).each(function(){if($(this).attr('value')===$(ths).data('val')){$(this).parents('label').click();}});$('#FindIdeaForm').submit();});$('.modal-idea-wrap-slider a.next').click(function(e){e.preventDefault();var obj=$('.modal-idea-top-slider-in .slick-slide');obj.each(function(k){if($(this).hasClass('slick-current')){if(obj.get(k+1)){$(obj.get(k+1)).find('.openIdea').click();}else{$(obj.get(0)).find('.openIdea').click();}return false;}});});$('.modal-idea-wrap-slider a.prev').click(function(e){e.preventDefault();var len=$('.modal-idea-top-slider-in .slick-slide').length;var obj=$('.modal-idea-top-slider-in .slick-slide');obj.each(function(k){if($(this).hasClass('slick-current')){if(obj.get(k-1)){$(obj.get(k-1)).find('.openIdea').click();}else{$(obj.get(len-1)).find('.openIdea').click();}return false;}});});if($('.modal-idea-top-slider-in').length){$('.modal-idea-top-slider-in').slick();$('.modal-idea-wrap-slider-in').slick();ideaInit();}$('#Idea .close-add').click(function(){history.pushState(null,'',"/photoideas/")})
window.onpopstate=function(event){event.preventDefault();checkIdeaLocation();};setTimeout(function(){checkIdeaLocation();},1000)}if($('#FindIdeaForm').length){$('.runIdeaSearch').click(function(e){e.preventDefault();$('#FindIdeaForm').submit();});}});function checkIdeaLocation(){const testURL=/\/photoideas\/([0-9]+)\//;let tmp=window.location.pathname.match(testURL);if(tmp){let newa='<a href="" id="tmpIdeaA" class="openIdea nopushhist" data-id="'+tmp[1]+'" style="position: absolute; right: 100%;"></a>';$('body').append(newa);ideaInit();$('#tmpIdeaA').click();}}function ideaInit(){$('.openIdea:not(.processed)').click(function(e){e.preventDefault();var id=$(this).data('id');if($('#Idea').css('display')!=='block'){$('#Idea').modal('show');}$('#Idea:not(.loading)').addClass('loading');$('#Idea .modal-idea-wrap-slider-in').html('<div class="one-big-modal">'+'<span></span>'+'</div>');if($(this).hasClass('inter')===false){reloadModalTopSlider();}if($(this).hasClass('nopushhist')===false){history.pushState(null,'',"/photoideas/"+id+"/");}$('#Idea .vk').attr('href','https://vk.com/share.php?url=https://wedwed.ru/photoideas/'+id+'/');$('#Idea .face').attr('href','https://www.facebook.com/sharer/sharer.php?u=https://wedwed.ru/photoideas/'+id+'/');$('#Idea .wapp').attr('href','whatsapp://send?text=https://wedwed.ru/photoideas/'+id+'/');loadIdeaData(id);setPositionTopSlider(id);window.refpage=1;loadRefData(id);$('#Idea').stop().animate({scrollTop:0});}).addClass('processed');initIdeaFav();}var forEach=function(collection,callback,scope){if(Object.prototype.toString.call(collection)==='[object Object]'){for(var prop in collection){if(Object.prototype.hasOwnProperty.call(collection,prop)){callback.call(scope,collection[prop],prop,collection);}}}else{for(var i=0,len=collection.length;i<len;i++){callback.call(scope,collection[i],i,collection);}}};function objectToArray(obj){var tmp=[];forEach(obj,function(value,index){tmp[tmp.length]=value;});return tmp;}function objectToArrayKeys(obj){var tmp=[];forEach(obj,function(value,index){tmp[tmp.length]=index;});return tmp;}function objectToArrayFull(obj){var tmp=[];forEach(obj,function(value,index){tmp[index]=value;});return tmp;}function tagJoin(tags){var html='';if(tags.length>0){for(let i=0;i<tags.length;i++){html=html+'<a href="#">'+tags[i]+'</a>';}}return html;}function colorJoin(cl){var html='';if(cl.length>0){for(let i=0;i<cl.length;i++){html=html+'<div class="modal-idea-line-color" data-color="'+cl[i]+'">'+'<span class="light" style="'+(cl[i]==='#gold'||cl[i]==='#silver'?'background-image: url(\'/theme/youwedme/img/'+cl[i].split('#').join('')+'.jpg\')':'background-color: '+cl[i]+'')+';">'+'</span>'+'</div>';}}return html;}function clearFiltersAndSelect(form,prop,val){form.find('input[type=checkbox]').each(function(){this.checked=false;});form.find('input[type=text]').each(function(){$(this).val('');});$('#Idea').modal('hide');setTimeout(function(){form.submit();},300);if(prop==='color'){val=hexToString(val.split('#').join(''));form.find('.namecolors').each(function(){if($(this).val()===val){this.checked=true;}});}if(prop==='category'){form.find('.namecategory').each(function(){if($(this).val()===val){this.checked=true;}});}}function loadRefData(id){$('#loadedid').val(id);window.ideaspagemodal=1;$('.idea-masonry-modal').addClass('loading').html('<div class="gutter-sizer"></div>');var data={page:1};$.ajax({url:'/api/ideas/loadRef/?id='+id,data:data,method:'post',dataType:'json',success:function(data){var res,html='<div class="gutter-sizer"></div>';if(data&&data.length){for(let i=0;i<data.length;i++){res=data[i];html=html+get_idea_view(res);}$('.idea-masonry-modal').html(html);setTimeout(function(){if(masonryactive===true){$('.idea-masonry-modal').masonry('destroy');}$('.idea-masonry-modal').removeClass('loading').masonry({itemSelector:'.one-idea-item',gutter:'.gutter-sizer',columnWidth:'.one-idea-item'});masonryactive=true;ideaInit();},2000);initIdeaFav();}else{console.log('Нет похожих');}}});}function loadIdeaData(id){var data={id:id};$.ajax({url:'/api/ideas/loadIdea/',data:data,method:'post',dataType:'json',success:function(data){console.log(data)
if(data.src){var colors=data.colors?objectToArrayKeys(data.colors):false;$('.modal-idea-wrap-slider-in').slick('destroy');$('#Idea .modal-idea-wrap-slider-in').html('<div class="one-big-modal">'+'<span>'+'<img src="'+data.src+'" alt="'+data.name+'" />'+'</span>'+'</div>');if(data.name){$('#Idea .modal-idea-right .modal-idea-name').html(data.name);$('#Idea .modal-idea-right .modal-idea-author').show();}else{$('#Idea .modal-idea-right .modal-idea-author').hide();}if(data.category){$('#Idea .modal-idea-right .modal-idea-line-category').html('<a href="">'+data.category.join('</a>, <a href="">')+'</a>');$('#Idea .modal-idea-right .modal-idea-line-category-wrap').show();$('.modal-idea-line-category a').click(function(e){e.preventDefault();var val=$(this).text();clearFiltersAndSelect($('#FindIdeaForm'),'category',val);});}else{$('#Idea .modal-idea-right .modal-idea-line-category-wrap').hide();}$('#Idea .modal-idea-right .modal-idea-avat span').attr('style','background-image:url('+data.photo_logo+')');$('#Idea .modal-idea-right .modal-idea-tit').html('<a href="/catalog/item/'+data.uid+'/" target="_blank">'+data.uname+'</a><span>'+data.spec+'</span>');if(data.city){$('#Idea .modal-idea-right .modal-idea-line-city').html(data.city);$('#Idea .modal-idea-right .modal-idea-line-city-wrap').show();}else{$('#Idea .modal-idea-right .modal-idea-line-city-wrap').hide();}$('#Idea .modal-idea-right .modal-idea-line-colors').html(colors?colorJoin(colors):'');if(data.styles.length){$('#Idea .modal-idea-right .modal-idea-line-styles').html(data.styles.join(',&nbsp;'));$('#Idea .modal-idea-right .modal-idea-line-styles-wrap').show();}else{$('#Idea .modal-idea-right .modal-idea-line-styles-wrap').hide();}if(data.tags.length){$('#Idea .modal-idea-right .modal-idea-line-wrap .tags-modal').html(tagJoin(data.tags));$('#Idea .modal-idea-right .modal-idea-line.tags-modal-wrap').show();}else{$('#Idea .modal-idea-right .modal-idea-line.tags-modal-wrap').hide();}if(data.fav){$('#Idea .modal-idea-right .modal-idea-fav a:not(.active)').addClass('active')}else{$('#Idea .modal-idea-right .modal-idea-fav a.active').removeClass('active')}$('#Idea .modal-idea-right .modal-idea-fav a .favCount').html(data.favcnt);if(data.utarif>0){$('#Idea .modal-idea-right .modal-idea-pro').show();}else{$('#Idea .modal-idea-right .modal-idea-pro').hide();}$('#Idea .modal-idea-right .favCount').html(data.favcnt?data.favcnt:'0');$('#Idea .modal-idea-right .ideasfavtext').html(data.infav?'Сохранено':'Сохранить');$('#Idea .modal-idea-right .ideasfav').attr('data-id',id).data('id',id);if(data.infav){$('#Idea .modal-idea-right .ideasfav').addClass('active');}else{$('#Idea .modal-idea-right .ideasfav').removeClass('active');}if(data.utype!==5&&data.discount>0){$('#Idea .modal-idea-right .modal-idea-sale').show();$('#Idea .modal-idea-right .modal-idea-sale .modal-idea-num-sale span').html('скидка '+data.discount+'%');}else{$('#Idea .modal-idea-right .modal-idea-sale').hide();}$('.modal-idea-line-color').click(function(e){e.preventDefault();if($('#FindIdeaForm').length){clearFiltersAndSelect($('#FindIdeaForm'),'color',$(this).data('color'));}});initIdeaFav();}}});}function setPositionTopSlider(id){setTimeout(function(){$('.modal-idea-top-slider-in').find('.slick-slide .openIdea.processed').unbind('click').removeClass('processed');$('.modal-idea-top-slider-in').find('.slick-slide:not(.slick-cloned) .openIdea[data-id='+id+']').parent().click();window.tmpel=$('.modal-idea-top-slider-in').find('.slick-slide:not(.slick-cloned) .openIdea[data-id='+id+']').parent();setTimeout(function(){window.tmpel.click();},500);ideaInit();$('#Idea.loading').removeClass('loading');},300);}function reloadModalTopSlider(){var html='';$('.idea-wrap .one-idea-item').each(function(){var id=$(this).find('a.openIdea').data('id');var thumb=$(this).find('.one-idea-item-thumb img').attr('src');html=html+'<div class="top-one-thumb">'+'<a href="#" class="openIdea inter" data-id="'+id+'">'+'<span style="background-image: url('+thumb+');"></span>'+'</a>'+'</div>';});$('.modal-idea-top-slider-in').slick('destroy');$('.modal-idea-top-slider-in').html(html);$('.modal-idea-top-slider-in').slick({dots:false,arrows:true,infinite:true,speed:300,slidesToShow:8,slidesToScroll:1,focusOnSelect:true,responsive:[{breakpoint:768,settings:{slidesToShow:4,slidesToScroll:1,centerMode:true,}}]});setTimeout(function(){$('.modal-idea-top-slider-in').slick('refresh');},300);}function stringToHex(cl){var ind=false;forEach(allcolors,function(value,index){if(value===cl){ind=index;}});return ind;}function hexToString(cl){var val=false;forEach(allcolors,function(value,index){if(index===cl){val=value;}});return val;}function get_idea_view($r){var colors='',value;if($r.colors!==null){for(let i=0;i<$r.colors.length;i++){value=stringToHex($r.colors[i]);if(value!==false){colors=colors+'<div class="one-idea-item-color"><span class="light" style="background-color: #'+value+';"></span></div>'}}}if(colors!==''){colors=''+colors+'';}var tpl='<div class="one-idea-item">'+'<div class="one-idea-item-thumb">'+'<img src="'+$r.thumb+'" alt="'+$r.name+'">'+'<a href="/photoideas/'+$r.id+'/" class="openIdea" data-id="'+$r.id+'"></a></div>'+'<div class="one-idea-item-descr">'+'<div class="one-idea-item-info">'+'<div class="one-idea-item-catalog">'+'<a href="/photoideas/'+$r.id+'/" class="openIdea" data-id="'+$r.id+'">'+($r.category?$r.category.join(', '):'')+'</a>'+'</div>'+'<div class="one-idea-item-color d-none">'+colors+'</div>'+'</div>'+'<div class="one-idea-item-bot">'+'<div class="one-idea-item-author">'+'<div class="one-idea-item-avat">'+'<span style="background-image: url('+$r.logo+');">'+'</span>'+'</div>'+'<div class="one-idea-item-name">'+$r.uname+'</div>'+'</div>'+'<div class="one-idea-item-fav">'+'<div class="one-inv-item-fav-btn">'+'<a href="#" class="ideasfav'+($r.infav?' active':'')+'" data-id="'+$r.id+'">'+' <span class="ideasfavtext">'+($r.inFav?'Сохранено':'Сохранить')+'</span>'+' <i></i>'+' <span class="favCount">'+($r.favcnt?$r.favcnt:'0')+'</span>'+'</a>'+'</a>'+'</div>'+'</div>'+'</div>'+'</div>'+'</div>';return tpl;}function lg(obj){console.log(obj);}function longYmapsPlacemark(coords,title){if(coords.length===2){coords[0]=parseFloat(coords[0]);coords[1]=parseFloat(coords[1]);if(!coords[0]){coords[0]=55.7522;coords[1]=37.6156;title='Некорректная геометка, уже исправляем ;-) ';}window.tmpcoords=coords;window.tmptitle=title;setTimeout(function(){if(typeof ymaps!=='undefined'&&typeof myMap!=='undefined'){myMap.container.fitToViewport();var myPlacemark=new ymaps.Placemark(window.tmpcoords,{iconContent:window.tmptitle,balloonContent:window.tmptitle},{preset:"islands#pinkStretchyIcon"});myMap.setCenter(window.tmpcoords,13);myMap.geoObjects.removeAll();myMap.geoObjects.add(myPlacemark);}else{setTimeout(function(){longYmapsPlacemark(window.tmpcoords,window.tmptitle);},100);}},500);}}function loadPlaces(map,id){var inid=parseInt(id);var data={};map.geoObjects.removeAll();var form=$('form.cat-filter').serializeArray();$.ajax({url:'/api/getPlaces/',method:'post',dataType:'json',data:form,cache:true,success:function(data){let item;if(data&&data.length){for(let i=0;i<data.length;i++){item=data[i];var myPlacemark=new ymaps.Placemark(item.coords,{balloonContent:item.about,balloonHeader:item.nameOf5,balloonImage:item.photo_main,balloonLogo:item.photo_logo,balloonLink:'/catalog/item/'+item.id+'/',balloonAddress:item.address,balloonId:'bal'+item.id},(item.id===inid?{iconLayout:'default#image',iconImageHref:'/theme/youwedme/html/newhtml/images/pina.png',iconImageSize:[60,66],iconImageOffset:[-28,-61],balloonShadow:false,balloonLayout:MyBalloonLayout,balloonContentLayout:MyBalloonContentLayout,balloonPanelMaxMapArea:0}:(item.stars?{iconLayout:'default#image',iconImageHref:'/theme/youwedme/html/newhtml/images/pin.png',iconImageSize:[24,29],iconImageOffset:[-10,-24],balloonShadow:false,balloonLayout:MyBalloonLayout,balloonContentLayout:MyBalloonContentLayout,balloonPanelMaxMapArea:0}:{iconLayout:'default#image',iconImageHref:'/theme/youwedme/html/newhtml/images/pingr.png',iconImageSize:[24,29],iconImageOffset:[-10,-24],balloonShadow:false,balloonLayout:MyBalloonLayout,balloonContentLayout:MyBalloonContentLayout,balloonPanelMaxMapArea:0})));map.geoObjects.add(myPlacemark);if(item.id===inid){map.setCenter(item.coords);map.setZoom(12);myPlacemark.events.fire('click');}}}}});}