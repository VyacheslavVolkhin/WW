var isserv=false;$(function(){$('.minPop-close').click(function(){$('.minPop').fadeOut();});$('.vk-modal').click(function(e){e.preventDefault();setTimeout(function(){$('#vk').modal('show');},500);});$('.reg-final').click(function(e){e.preventDefault();setTimeout(function(){$('#final').modal('show');},500);});$('.forg-pass a').click(function(e){e.preventDefault();setTimeout(function(){$('#forg').modal('show');},500);});$('.back-tit').click(function(e){e.preventDefault();setTimeout(function(){$('#loginMod').modal('show');},500);});var date=new Date();var timestamp=date.getTime();$('.payNow').click(function(e){e.preventDefault();if($('#endModal.in').length){$('#endModal').modal('hide');setTimeout(function(){$('#payModal').modal('show');},400);}else{$('#payModal').modal('show');}});$('#forgPassForm').submit(function(e){e.preventDefault();$('#forg').modal('hide');var form=this;if(ch_form(form)){$.ajax({url:'/login/password/',method:'post',data:{submit:'true',email:$(form).find('input[name=email]').val()},success:function(data){setTimeout(function(){$('#forgok').modal('show');},500);}});}});$('#nLoginForm').submit(function(e){e.preventDefault();var form=this;if(ch_form(form)){let data={login:$(this).find('input[name=login_email]').val(),password:$(this).find('input[name=login_password]').val()};$.ajax({url:'/modules/ajax/login.php',method:'post',cache:false,data:data,success:function(json){if(json==-1){$(form).find('input[name=login_email],input[name=login_password]').addClass('error').keydown(function(){$(this).unbind('keydown').removeClass('error');});}else{if(json){$('#loginMod').modal('hide');sb_setCookie_copy('show_popup','1',{secure:true,'max-age':3600});if(window.needredirect){window.location.href='/user/';}else{window.location.reload();}}}}});}});$('#finalRegForm').submit(function(e){e.preventDefault();var form=this;if(ch_form(form)){var data=$(this).serializeArray();if($(window.from_form)&&$(window.from_form).find('input[name=phone]').length>0){data.push({name:'phone',value:$(window.from_form).find('input[name=phone]').val()});}else{data.push({name:'noemail',value:'1'});}data.push({name:'submit',value:'true'});data.push({name:'usertype',value:'client'});let lost=getCookiebn('lost');let first_name=getCookiebn('first_name');let email=getCookiebn('email');let profile=getCookiebn('profile');let network=getCookiebn('network');let identity=getCookiebn('identity');let uid=getCookiebn('identity');if(typeof lost!=='undefined'){data.push({name:'lost',value:lost});data.push({name:'network',value:(typeof network==='undefined'?'':network)});data.push({name:'identity',value:(typeof identity==='undefined'?'':identity)});data.push({name:'profile',value:(typeof saveprofile==='undefined'?'':saveprofile)});data.push({name:'uid',value:(typeof uid==='undefined'?'':uid)});}else{data.push({name:'lost',value:''});data.push({name:'network',value:''});data.push({name:'identity',value:''});data.push({name:'profile',value:''});data.push({name:'uid',value:''});}console.log(data);$.ajax({url:'/register/',data:data,method:'post',dataType:'json',success:function(data){let fld=false;if(data.register&&data.register==='ok'){if(data.redirect=='1'){window.location.href='/desktop/';}else{sb_setCookie_copy('show_popup','1',{secure:true,'max-age':3600});if(data.redirect==='/desktop/?_super=client'){ym(44538871,'reachGoal','newRegEnd');}window.location.href=data.redirect;}}else{if(data.field&&data.field[0]){if(data.field[0]==='login'){fld=$(form).find('input[name=login]');}if(data.field[0]==='email'){fld=$(form).find('input[name=email]');}if(data.field[0]==='password'){fld=$(form).find('input[name=password]');}if(fld){fld.addClass('error').keydown(function(){$(this).unbind('keydown').removeClass('error');$(this).parent().find('.one-modal-inp-error').fadeOut(400,function(){$(this).remove();});});if(fld.parent().find('.one-modal-inp-error').length===0){fld.parent().append('<div class="one-modal-inp-error"></div>');}fld.parent().find('.one-modal-inp-error').html(data.error).fadeIn();}else{if(data.field[0]==='captcha'){fld=$(form).find('.g-recaptcha').addClass('error');setTimeout(function(){fld.removeClass('error');fld.parent().find('.one-modal-inp-error').fadeOut(400,function(){$(this).remove();});},3500);if(fld.parent().find('.one-modal-inp-error').length===0){fld.parent().append('<div class="one-modal-inp-error"></div>');}fld.parent().find('.one-modal-inp-error').html(data.error).fadeIn();}}}}}});}return false;});$('#chCodeForm').submit(function(e){e.preventDefault();var data={code_sms:$(this).find('input[name=code_sms]').val()};if(ch_form(this)){$.ajax({url:'/service/check-code-sms/',data:data,method:'post',dataType:'json',success:function(data){if(data===true){$('#smsMod').modal('hide');setTimeout(function(){$.ajax({url:'/api/regPay/',data:data,method:'post',success:function(data){if(data=='1'){window.location.href='/desktop/';}else{alert('Error');}}});},500);}}});}});if($('#SBregForm').length&&typeof FB==='undefined'){$('head').append('<script type="text/javascript" src="/theme/youwedme/html/newreg/actionreg.js?v='+Math.random()+'"></script>');}$('.ToLK').click(function(e){e.preventDefault();e.stopPropagation();window.location.href='/user/';});$('.regBtn').click(function(e){e.preventDefault();e.stopPropagation();if($('.mfp-ready').length){$('.mfp-close').click();setTimeout(function(){if($('#regMod').length){$('#regMod').modal('show');}},400)}else{if($('#regMod').length){$('#regMod').modal('show');}}});$('.reloadBtnWORedirect').click(function(e){e.preventDefault();setTimeout(function(){window.needredirect=false;},50);});$('.loginBtn').click(function(e){e.preventDefault();e.stopPropagation();window.needredirect=true;if($('#loginMod').length){if($('#regMod').hasClass('show')){$('#regMod').modal('hide');setTimeout(function(){$('#loginMod').modal('show');},500);}else{if($('#forgok').hasClass('show')){$('#forgok').modal('hide');setTimeout(function(){$('#loginMod').modal('show');},500);}else{$('#loginMod').modal('show');}}}});$('#SBregFormVK').submit(function(e){e.preventDefault();var data={phone:$(this).find('input[name=phone]').val()};if(ch_form(this)){window.from_form=this;window.sms_counter=30;$('#regvkmod').modal('hide');setTimeout(function(){$('#smsMod').modal('show').find('form').get(0).reset();setTimeout(function(){$('#smsMod input[name=code_sms]').get(0).focus();},500);},500);window.sms_el=$("#smsMod .inp-info-mess").get(0);ssms_counter_start();$.ajax({url:'/service/send-sms/',data:data,method:'get',success:function(data){if(data.status&&data.status==='Ok'){console.log('SMS отправлена');}}});}});$('#SBregForm').submit(function(e){e.preventDefault();var data={phone:$(this).find('input[name=phone]').val()};if(ch_form(this)){if(isserv){stepByStepRegister_new();}else{window.from_form=this;window.sms_counter=30;$('#regMod').modal('hide');setTimeout(function(){$('#smsMod').modal('show').find('form').get(0).reset();setTimeout(function(){$('#smsMod input[name=code_sms]').get(0).focus();},500);},500);window.sms_el=$("#smsMod .inp-info-mess").get(0);ssms_counter_start();$.ajax({url:'/service/send-sms/',data:data,method:'get',success:function(data){if(data.status&&data.status==='Ok'){console.log('SMS отправлена');}}});}}});$('#SBregFormShort').submit(function(e){e.preventDefault();$('.hidden-info').hide();let email=$(this).find('input[name=email]').val()
var data={email:email};if(ch_form(this)){$.ajax({url:'/api/regPay/',data:data,method:'post',success:function(data){if(data=='1'){window.location.href='/desktop/payinit/';}else if(data=='2'){$('.hidden-info').show();}}});}});if($('body').hasClass('nophone')){$('#regMod').appendTo(document.body);$('#regMod').modal('show');}$('.d-service').stop().hide();$('.d-noservice').stop().show();$('#SBregForm .choose-role label input[name=person]').change(function(){if(this.checked){if(this.value==='customer'){$('.d-service').stop().slideUp(300);$('.d-noservice').stop().slideDown(300);isserv=false;}else if(this.value==='executive'){$('.d-service').stop().slideDown(300);$('.d-noservice').stop().slideUp(300);isserv=true;}}});if($(".sjs-styled").length){if(typeof $(".sjs-styled").styler==='undefined'){$('body').append('<script type="text/javascript" src="/theme/youwedme/html/newhtml/js/jquery.formstyler.min.js?v='+Math.random()+'"></script>');}$('body').append('<link href="/theme/youwedme/new_auth/css/jquery.formstyler.theme.css?v='+Math.random()+'" rel="stylesheet" type="text/css" />');$(".sjs-styled").styler();}});function ch_form(form){var errors=0,err,phonetest=/\+7 \d{3} \d{3} \d{2} \d{2}/g,phonetest2=/\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}/g,emtest=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$(form).find('.required').each(function(k,el){err=false;if(el.type==='email'){if(!emtest.test($(el).val())){err=true;errors++;}else{$(el).unbind('keydown').unbind('change').removeClass('error');}}else{if(el.type==='tel'){if(!phonetest.test($(el).val())&&!phonetest2.test($(el).val())){err=true;errors++;}else{$(el).unbind('keydown').unbind('change').removeClass('error');}}else{if(!$(el).val()||$(el).val()==='00.00.0000'){err=true;errors++;}else{$(el).unbind('keydown').unbind('change').removeClass('error');}}}if(err){$(el).addClass('error').bind('keydown change',function(){$(this).unbind('keydown change').removeClass('error');}).change(function(){$(this).unbind('keydown change').removeClass('error');});}});return errors>0?false:true;}function ssms_counter_start(){$(window.sms_el).html('Вы можете отправить код повторно через<br />'+window.sms_counter+' секунд');setTimeout(function(){window.sms_counter=window.sms_counter-1;if(window.sms_counter<1){$(window.sms_el).html('<a href="">Отправить еще раз</a>');$(window.sms_el).find('a').click(function(e){e.preventDefault();$(window.from_form).submit();});}else{ssms_counter_start();}},1000);}function stepByStepRegister_new(){sb_setCookie_copy('reg_phone',$('#SBregForm input[name=phone]').val(),{secure:true,'max-age':3600});sb_setCookie_copy('reg_spec',$('#SBregForm select[name=specialization]').val(),{secure:true,'max-age':3600});window.location.href='/stepbystep/';}function sb_setCookie_copy(name,value,options={}){options={path:'/'};if(options.expires instanceof Date){options.expires=options.expires.toUTCString();}let updatedCookie=encodeURIComponent(name)+"="+encodeURIComponent(value);for(let optionKey in options){updatedCookie+="; "+optionKey;let optionValue=options[optionKey];if(optionValue!==true){updatedCookie+="="+optionValue;}}document.cookie=updatedCookie;}function getCookiebn(name){var value="; "+document.cookie;var parts=value.split("; "+name+"=");if(parts.length===2)return parts.pop().split(";").shift();}$(function(){var vk_login=getCookiebn('vk_login');if(typeof vk_login!=='undefined'){document.cookie='vk_login=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';VK.Auth.login(function(response){if(response.session){respons={};respons['first_name']=response.session.user.first_name;respons['email']='';respons['network']='vkontakte';respons['uid']=response.session.user.id;respons['profile']=response.session.user.href;$.post("/service/uloginauth/",{'udata':respons},function(data){if(data==='ok'){sb_setCookie_copy('show_popup','1',{secure:true,'max-age':3600});window.location.href="/user/";}});}else{}});}else{var vk_register=getCookiebn('vk_register');if(typeof vk_register!=='undefined'){$('#regvkmod').modal('show');$("#socialRegisterOne div.jq-radio.js-styled:last").addClass("checked");$("#socialRegisterOne div.jq-radio.js-styled:last input[name=social]").attr("checked","checked");document.cookie='vk_register=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';VK.Auth.login(function(response){if(response.session){respons={};respons['first_name']=response.session.user.first_name;respons['email']='';respons['network']='vkontakte';respons['uid']=response.session.user.id;respons['profile']=response.session.user.href;window.saveprofile=response.session.user.href;$("#finalRegMod input[name=firstname]").val(response.session.user.first_name+' '+response.session.user.last_name);$.post("/service/ulogin/",{'udata':respons,'test':true},function(data){console.log("Регистрация в незавершенных");});}else{}});}}});function saveThisByHref(a){var reg=/[?&]+id=(\d+)/,tmp=a.href?a.href.match(reg):false;if(tmp&&isset_cust(tmp[1])){sb_setCookie_copy('toFavID',tmp[1],{secure:true,'max-age':3600});}}function isset_cust(accessor){try{return accessor!==undefined&&accessor!==null;}catch(e){return false;}}