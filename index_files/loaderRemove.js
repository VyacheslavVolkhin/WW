if(typeof goodColors!=='undefined'){var indexedColors=allHexToRgb(goodColors);}var topalertcounter=false,topalertcounter2=false,sharettimer=false;var div=document.createElement('div');div.style.overflowY='scroll';div.style.width='50px';div.style.height='50px';div.style.visibility='hidden';document.body.appendChild(div);var scrollWidth=div.offsetWidth-div.clientWidth;document.body.removeChild(div);if(typeof isMobile==='undefined'){var isMobile=false;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))){isMobile=true;}}$(document).ready(function(){$('.wedloader').remove();})
$(function(){if($('.item-nav').length){if(isMobile){$('.item-nav').slick({dots:false,infinite:false,arrows:false,slidesToShow:6,slidesToScroll:2,swipeToSlide:true,variableWidth:true,responsive:[{breakpoint:1024,settings:{slidesToShow:4,slidesToScroll:2}},{breakpoint:890,settings:{slidesToShow:3,slidesToScroll:2}},{breakpoint:600,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]});}$('.item-nav a').click(function(e){e.preventDefault();let to=this.href.split('#');if(to.length===2){to='#'+to[1];$('html, body').stop().animate({scrollTop:$(to).offset().top},700);}});}priceListInit();var handler=function(){var e=($("footer").height(),$("header").height()),t=viewport().width,i=viewport().height;$(".js-section").length&&$(".js-section").css({"min-height":i-e+"px"}),t>1200&&($("html").removeClass("blocked"),$(".js-header-mobile__nav-trigger").removeClass("active"),$(".js-header-mobile-nav").removeClass("opened"))};$(window).on("resize",handler),window.Utils={magnificPopupConfiguration:function(){var e=0;return{beforeOpen:function(){e=$(window).scrollTop(),$("html").addClass("mfp-helper");},close:function(){$("html").removeClass("mfp-helper"),setTimeout(function(){$("body").animate({scrollTop:e},0);},0);}};}};if($('#topalert').length===0){$('body').append('<div id="topalert"></div>');}$('.ajax-fav').click(function(event){event.preventDefault();if(userauth){var ths=this;if(topalertcounter2){clearTimeout(topalertcounter2);}topalertcounter2=setTimeout(function(){topalert('',-1);},700);$.ajax({method:'get',url:$(ths).attr('href')+'',cache:false,dataType:'json',success:function(data){clearTimeout(topalertcounter2);let st=false;if(data.status){if(data.status==='Ok'){$(ths).toggleClass('active');st=true;}if(data.status==='Nothing'){st=true;if(data.message==='Уже добавлено'){data.link=$(ths).attr('href').split('&action=add&').join('&action=delete&');$(ths).addClass('active');}else{data.link=$(ths).attr('href').split('&action=delete&').join('&action=add&');$(ths).removeClass('active');}}topalert(data.message?data.message:'',true);if(data.link){$(ths).attr('href',data.link);}if(data.data){if(data.data.selector){$(data.data.selector).length&&$(data.data.selector).html(data.data.value?data.data.value:'');if(data.data.selector==='#wishlist_count'){$('.header-top__wish .icon').html(parseInt(data.data.value?data.data.value:'0'));$('.header-newfav span').html(parseInt(data.data.value?data.data.value:'0'));$('.wed-wishlist').html(parseInt(data.data.value?data.data.value:'0'));$('.fav.right-side a i').html(parseInt(data.data.value?data.data.value:'0'));}}}}else{topalert('Некорректный ответ сервера',false);}}});}else{saveThisByHref(this);if($('.mfp-ready').length){$('.mfp-close').click();setTimeout(function(){if($('#regMod').length){$('#regMod').modal('show');}},400);}else{if($('#Idea:visible').length){$('#Idea:visible .close-add').click();setTimeout(function(){if($('#regMod').length){$('#regMod').modal('show');}},400);}else{if($('#regMod').length){$('#regMod').modal('show');}}}}});setInterval(function(){if($('body').hasClass('showfav')||$('body').hasClass('modal-open')||$('body').hasClass('mfp-zoom-out-cur')||$('html').hasClass('blocked')||$('html').hasClass('mfp-helper')||$('html').hasClass('fancybox-lock')||$('#fastOrderModal').css('display')==='block'||$('.fancybox-opened').length>0||$('.mfp-ready.mfp-bg').length>0){$('.ws-chat,.carrotquest-css-reset').hide();}else{$('.ws-chat,.carrotquest-css-reset').show();}},100);$('.fav-close,.header-top__wish, .wed-wishlist,.fav.right-side,.newfav,.fav-link').click(function(e){e.preventDefault();$('.fav-show').toggleClass('showed');$('body').toggleClass('showfav');if($('body').hasClass('showfav')){$('.fav-show').addClass('loading');$('.fav-wrap').html('');wedLoadFav();}return false;});if($(".js-datepicker-fav").length){$(".js-datepicker-fav").Zebra_DatePicker({container:$(".box-field--date-fav"),format:"d.m.Y",direction:1,default_position:"below",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],days:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],lang_clear_date:"Очистить",show_select_today:"Сегодня"});}$('.dateSpicker-inp').focus(function(event){$(this).parents('.box-field').find('.modal-dateSpicker').fadeIn();event.preventDefault();});$('.dateSpicker-inp2').focus(function(event){$(this).parents('.one-form-place').find('.modal-dateSpicker2').fadeIn();event.preventDefault();});$('.choose-bt-fav a').click(function(event){$(this).parents('.modal-dateSpicker').fadeOut();event.preventDefault();});$('.choose-bt-fav2 a').click(function(event){$(this).parents('.modal-dateSpicker2').fadeOut();event.preventDefault();});if($('.data-pick-fav').length){$('.data-pick-fav').dateSpicker({inline:true,multipleDates:true,minDate:new Date(),onSelect:function(formattedDate,date,inst){$(inst.el).parents('.box-field').find('input.dateSpicker-inp').val(formattedDate).change();}});}if($('.data-pick-fav2').length){$('.data-pick-fav2').dateSpicker({inline:true,multipleDates:true,minDate:new Date(),onSelect:function(formattedDate,date,inst){$(inst.el).parents('.one-form-place').find('input.dateSpicker-inp2').val(formattedDate).change();}});}if($('.data-pick-kabinet').length){$('.data-pick-kabinet').dateSpicker({inline:false,multipleDates:false,minDate:new Date('December 17, 1995 03:24:00'),onSelect:function(formattedDate,date,inst){$(inst.el).parents('.specialistinfo').find('input.data-pick-kabinet').val(formattedDate).change();}});}if($('.data-pick-kab').length){$('.data-pick-kab').dateSpicker({inline:false,multipleDates:false,minDate:new Date('December 17, 1995 03:24:00'),onSelect:function(formattedDate,date,inst){$(inst.el).parents('label').find('input.data-pick-kab').val(formattedDate).change();}});}$('.competition').unbind();setInterval(function(){$('.competition').unbind();},1000);$('#compclose').click(function(e){e.preventDefault();$.ajax({url:'/competition/',method:'get',dataType:'text',success:function(){$('#compblock').fadeOut();}});});if($('.photoeditor').length>0){$('.crop-cancel').click(function(e){e.preventDefault();var type=img_type.toString();$('input[name=x_'+type+'],input[name=x2_'+type+'],input[name=y_'+type+'],input[name=y2_'+type+'],input[name=h_'+type+'],input[name=w_'+type+']').val(0);$('.photoeditor').fadeOut();});$('.crop-save').click(function(e){e.preventDefault();var type=img_type.toString();var up_name='';if(type==='main'){up_name='photo_main';}else if(type==='logo'){up_name='photo_logo';}else if(type==='banner'){up_name='photo_banner';}else if(type==='manager'){up_name='photo_manager';}let img=$('.photoeditor .photozone img');if(isMobile){$('input[name=w_'+type+']').val('0');$('input[name=h_'+type+']').val('0');}else{$('input[name=w_'+type+']').val(parseInt(img.width()));$('input[name=h_'+type+']').val(parseInt(img.height()));}$('.photoeditor').fadeOut();var block=img.get(0).src.split(";");var contentType=block[0].split(":")[1];var realData=block[1].split(",")[1];var blob=base64ToBlob(realData,contentType);var formDataToUpload=new FormData();var line="?x_"+type+'='+parseInt($('input[name=x_'+type+']').val())+"&y_"+type+'='+parseInt($('input[name=y_'+type+']').val())+"&x2_"+type+'='+parseInt($('input[name=x2_'+type+']').val())+"&y2_"+type+'='+parseInt($('input[name=y2_'+type+']').val())+"&h_"+type+'='+parseInt($('input[name=h_'+type+']').val())+"&w_"+type+'='+parseInt($('input[name=w_'+type+']').val());formDataToUpload.append(up_name,blob);$.ajax({url:'/api/saveStep2/'+line,type:"POST",cache:false,contentType:false,processData:false,data:formDataToUpload,success:function(data){if(data.status){process_new_images(data.data);}},error:function(data){}});});$('.photoloader input[type=file]').change(function(e){e.preventDefault();var type=$(this).data('type');if(this.files&&this.files[0]){var FR=new FileReader();FR.addEventListener("load",function(e){photoEditorInit(e.target.result,type);});FR.readAsDataURL(this.files[0]);something_happens($(this));}});}});function base64ToBlob(base64,mime){mime=mime||'';var sliceSize=1024;var byteChars=window.atob(base64);var byteArrays=[];for(var offset=0,len=byteChars.length;offset<len;offset+=sliceSize){var slice=byteChars.slice(offset,offset+sliceSize);var byteNumbers=new Array(slice.length);for(var i=0;i<slice.length;i++){byteNumbers[i]=slice.charCodeAt(i);}var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray);}return new Blob(byteArrays,{type:mime});}function something_happens(input){input.replaceWith(input.val('').clone(true));}function get_dimensions(el){if(el.naturalWidth!=undefined){return{'real_width':el.naturalWidth,'real_height':el.naturalHeight,'client_width':el.width,'client_height':el.height};}else if(el.tagName.toLowerCase()=='img'){var img=new Image();img.src=el.src;var real_w=img.width;var real_h=img.height;return{'real_width':real_w,'real_height':real_h,'client_width':el.width,'client_height':el.height};}else{return false;}}function photoEditorInit(data,type){window.img_type=type;if(window.cropo){}$('.photoeditor .photozone').html('<img src="/upload/z.gif" alt="">');if(!isMobile){$('.photoeditor').fadeIn(300);}let img=$('.photoeditor .photozone img').get(0);img.onload=function(){let img=$('.photoeditor .photozone img');let sizes=get_dimensions(img.get(0));var type=img_type.toString();let needsizes=[60,60];if(type==='logo'){needsizes=[172,172];}else if(type==='main'){needsizes=[299,199];}else if(type==='banner'){needsizes=[940,580];}else if(type==='manager'){needsizes=[130,130];}$('input[name=x_'+type+'],input[name=x2_'+type+'],input[name=y_'+type+'],input[name=y2_'+type+'],input[name=h_'+type+'],input[name=w_'+type+']').val(0);if(sizes&&sizes.real_width>=needsizes[0]&&sizes.real_height>=needsizes[1]){if(!isMobile){window.cropo=$.Jcrop(img,{aspectRatio:needsizes[0]/needsizes[1],minSize:needsizes,bgOpacity:.4,bgColor:'white',onChange:function(i){let img=$('.photoeditor .photozone img');var type=img_type.toString();$('input[name=x_'+type+']').val(parseInt(i.x));$('input[name=y_'+type+']').val(parseInt(i.y));$('input[name=x2_'+type+']').val(parseInt(i.x2));$('input[name=y2_'+type+']').val(parseInt(i.y2));}});}else{$('input[name=x_'+type+']').val('0');$('input[name=y_'+type+']').val('0');$('input[name=x2_'+type+']').val('0');$('input[name=y2_'+type+']').val('0');$('.photoeditor').stop().hide();$('.crop-save').click();}}else{$('.photoeditor .photozone').html('<span class="help-block"><p>Некорректное изображение.</p></span>');}};img.src=data;}$('#registerFormSt1 input').keypress(function(e){if(e.keyCode===13){$('.process-form').click();}});if($('.slider-input').length){$('.slider-input').each(function(k,item){new Slider(item,{tooltip:'hide',formatter:function(value){$('#slider-label').html(value+'%');return value+'%';}});});}$('.stepform').submit(function(e){e.preventDefault();});$('.price-list .add-btn').click(function(){var cnt=$(this).parent().parent();var name=cnt.find('.cval'),val1=cnt.find('.cval1'),val2=cnt.find('.cval2');var errors=0;if(!name.val()){errors++;name.addClass('error').keyup(function(){$(this).unbind('keyup,change').removeClass('error');}).change(function(){$(this).unbind('keyup,change').removeClass('error');});}if(!val1.val()||parseFloat(val1.val())<=0||val1.val()===''){errors++;val1.addClass('error').keyup(function(){$(this).unbind('keyup,change').removeClass('error');}).change(function(){$(this).unbind('keyup,change').removeClass('error');});}if(errors===0){if(parseFloat(val2.val())<=parseFloat(val1.val())||val2.val()===''){val2.val('0');}var sp1,sp2;if(parseFloat(val2.val())<=0){sp1='<span class="val1">'+formatMoney(val1.val(),0,'','&nbsp;')+' руб.</span>';sp2='<span class="val2" style="display: none;"> - 0</span>';}else{sp1='<span class="val1">'+formatMoney(val1.val(),0,'','&nbsp;')+'</span>';sp2='<span class="val2"> - '+formatMoney(val2.val(),0,'','&nbsp;')+'&nbsp;руб.</span>';}$('.insert-more-here').before('<div class="row newprice">'+'<div class="col-md-7 price-label">'+'<span class="val">'+escapeHtml(name.val())+'</span> <span class="moderline">на модерации</span>'+'<input type="hidden" class="form-control cval" placeholder="Название услуги" name="pricesn[]" value="'+escapeHtml(name.val())+'" />'+'<input type="hidden" class="notouch bval" />'+'</div>'+'<div class="col-md-4 price-value">'+'<div class="box-field__input input-range">'+sp1+'<input type="hidden" class="form-control cval1" placeholder="Цена, от" minlength="5" name="pricesf[]" value="'+val1.val()+'" />'+'<input type="hidden" class="notouch bval1" />'+sp2+'<input type="hidden" class="form-control cval2" placeholder="Цена, от" minlength="5" name="pricest[]" value="'+val2.val()+'" />'+'<input type="hidden" class="notouch bval2" />'+'</div>'+'</div>'+'<div class="col-md-1 price-control text-right">'+'<a href="javascript:void(0);" class="fa fa-pencil edit-price-value"></a> <a href="javascript:void(0);" class="fa fa-close del-price-value"></a>'+'<div class="controls2"><a href="javascript:void(0);" class="fa fa-check save-price-value"></a> <a href="javascript:void(0);" class="fa fa-close cancel-price-value"></a></div>'+'</div>'+'</div>');name.val('');val1.val('');val2.val('');priceListInit();}});$('.process-form').click(function(e){e.preventDefault();if($(this).hasClass('current-form3')){window.location.href=this.href;}if($(this).hasClass('current-form2')){var frm=$('#masterFormSt2');$.ajax({type:frm.attr('method'),url:'/api/saveStep1/',data:frm.serialize(),cache:false,success:function(data){if(data.status&&data.status===true){location.href='/user/';}},error:function(data){}});}if($(this).hasClass('current-form1')){var frm=$('#registerFormSt1');var coords=frm.find('input[name=coords]');if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){coords.val(position.coords.latitude+','+position.coords.longitude);},function(){coords.val('');});}else{coords.val('');}let re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;let errors=0;if(!frm.find('input[name=login]').val()){frm.find('input[name=login]').addClass('error').keyup(function(e){if(e.keyCode!==13){$('#registerFormSt1 input[name=login]').unbind('keyup').removeClass('error');}}).change(function(){$('#registerFormSt1 input[name=login]').unbind('keyup').removeClass('error');});errors++;}if(!frm.find('input[name=email]').val()||!re.test(String(frm.find('input[name=email]').val()).toLowerCase())){frm.find('input[name=email]').addClass('error').keyup(function(){frm.find('input[name=email]').unbind('keyup').removeClass('error');});errors++;}if(!frm.find('input[name=password]').val()){frm.find('input[name=password]').addClass('error').keyup(function(){$('#registerFormSt1 input[name=password]').unbind('keyup').removeClass('error');});errors++;}if(errors===0){$.ajax({type:frm.attr('method'),url:frm.attr('action'),data:frm.serialize(),cache:false,success:function(data){console.log(data)
if(data.register==='ok'){if($('#registerFormSt1 input[name=specialization]').val()==='2'){location.href='/stepbystep/?step=2&usertype=place&nusertype=2';}else{location.href='/stepbystep/?step=2&usertype=face&nusertype='+$('#registerFormSt1 input[name=specialization]').val();}}else{if(data.error){if(data.error==='Такой логин уже занят'||data.error==='Нельзя использовать @ в названии логина'){frm.find('input[name=login]').addClass('error').keyup(function(e){if(e.keyCode!==13){$('#registerFormSt1 input[name=login]').unbind('keyup,change').removeClass('error').parent().find('.err-desc').remove();}}).change(function(){$('#registerFormSt1 input[name=login]').unbind('keyup,change').removeClass('error').parent().find('.err-desc').remove();}).parent().append('<span class="err-desc">'+data.error+'</span>');}if(data.error==='Вы уже зарегистрированны'){window.location.href='/stepbystep/?step=2';}if(data.error==='Такая почта уже занята'){frm.find('input[name=email]').addClass('error').keyup(function(e){if(e.keyCode!==13){$('#registerFormSt1 input[name=email]').unbind('keyup,change').removeClass('error').parent().find('.err-desc').remove();}}).change(function(){$('#registerFormSt1 input[name=email]').unbind('keyup,change').removeClass('error').parent().find('.err-desc').remove();}).parent().append('<span class="err-desc">'+data.error+'</span>');}if(data.error==='Пароль должен состоять минимум из 6 символов'){frm.find('input[name=password],input[name=password2]').val('').addClass('error').keyup(function(e){if(e.keyCode!==13){$('#registerFormSt1 input[name=password],#registerFormSt1 input[name=password2]').unbind('keyup,change').removeClass('error').parent().find('.err-desc').remove();}}).change(function(){$('#registerFormSt1 input[name=password],#registerFormSt1 input[name=password2]').unbind('keyup,change').removeClass('error').parent().find('.err-desc').remove();}).parent().append('<span class="err-desc">'+data.error+'</span>');}if(data.error==='Ошибка. Вы не прошли проверку робота'){frm.find('.g-recaptcha').addClass('error').find('textarea').change(function(){$('#registerFormSt1 .g-recaptcha textarea]').unbind('change').parent('.g-recaptcha').removeClass('error');});}}}},error:function(data){}});}}if($(this).hasClass('current-form4')){}});function disablecontext(e){var clickedEl=(e==null)?event.srcElement.tagName:e.target.tagName;if(clickedEl=="IMG"){return false;}}document.oncontextmenu=disablecontext;function process_new_images(data){if(data){if(data.photo_main){$('.main_image').attr('src',data.photo_main);}if(data.photo_logo){$('.logo_image').attr('src',data.photo_logo);}if(data.photo_banner){$('.banner_image').attr('src',data.photo_banner);}if(data.photo_manager){$('.delManagerPhoto').removeClass('d-none');$('.manager_image1').attr('src',data.photo_manager+'_1');$('.manager_image2').attr('src',data.photo_manager+'_2');$('.manager_image3').attr('src',data.photo_manager+'_3');$('.manager_image4').attr('src',data.photo_manager+'_4');}}}function escapeHtml(text){var map={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'};return text.replace(/[&<>"']/g,function(m){return map[m];});}function priceListInit(){if($('.row.price-list').length){$('.del-price-value:not(.processed)').click(function(e){e.preventDefault();if(confirm('Точно удалить?')){$(this).parent().parent().remove();}}).addClass('processed');$('.save-price-value:not(.processed)').click(function(e){e.preventDefault();var cnt=$(this).parent().parent().parent();var name=cnt.find('.cval'),val1=cnt.find('.cval1'),val2=cnt.find('.cval2'),bname=cnt.find('.bval'),bval1=cnt.find('.bval1'),bval2=cnt.find('.bval2');if(parseFloat(val2.val())<=parseFloat(val1.val())||val2.val()===''){val2.val('0');}cnt.find('.val').html(escapeHtml(name.val()));cnt.find('.val,.val1,.moderline').css({display:'inline'});cnt.find('input.form-control').attr('type','hidden');cnt.find('.controls2').hide();if(parseFloat(val2.val())<=0){cnt.find('.val1').html(formatMoney(val1.val(),0,'','&nbsp;')+'&nbsp;руб.');cnt.find('.val2').css({display:'none'});}else{cnt.find('.val1').html(formatMoney(val1.val(),0,'','&nbsp;'));cnt.find('.val2').html(' - '+formatMoney(val2.val(),0,'','&nbsp;')+'&nbsp;руб.');}}).addClass('processed');$('.edit-price-value:not(.processed)').click(function(e){e.preventDefault();var cnt=$(this).parent().parent();var name=cnt.find('.cval'),val1=cnt.find('.cval1'),val2=cnt.find('.cval2'),bname=cnt.find('.bval'),bval1=cnt.find('.bval1'),bval2=cnt.find('.bval2');bname.val(name.val());bval1.val(val1.val());bval2.val(val2.val());cnt.find('.val2').css({display:'inline'}).html(' - ');cnt.find('.val,.val1,.moderline').css({display:'none'});cnt.find('.price-label input[type=hidden].form-control').attr('type','text');cnt.find('.price-value input[type=hidden].form-control').attr('type','number');cnt.find('.controls2').show();if(name.length){name.get(0).focus();}}).addClass('processed');$('.price-list .price-label .form-control:not(.processed),.price-list .price-value .form-control:not(.processed)').keyup(function(e){if(e.keyCode===13){if(this.type==='number'){var cnt=$(this).parent().parent().parent();}else{var cnt=$(this).parent().parent();}if(cnt.find('.save-price-value').length){cnt.find('.save-price-value').click();}else{if(cnt.hasClass('price-label')){cnt=cnt.parent();}cnt.find('.add-btn').click();}}}).addClass('processed');$('.cancel-price-value:not(.processed)').click(function(e){e.preventDefault();var cnt=$(this).parent().parent().parent();var name=cnt.find('.cval'),val1=cnt.find('.cval1'),val2=cnt.find('.cval2'),bname=cnt.find('.bval'),bval1=cnt.find('.bval1'),bval2=cnt.find('.bval2');if(parseFloat(val2.val())<=parseFloat(val1.val())||val2.val()===''){val2.val('0');}name.val(bname.val());val1.val(bval1.val());val2.val(bval2.val());cnt.find('.val').html(escapeHtml(name.val()));cnt.find('.val,.val1,.moderline').css({display:'inline'});cnt.find('input.form-control').attr('type','hidden');cnt.find('.controls2').hide();if(parseFloat(val2.val())<=0){cnt.find('.val1').html(formatMoney(val1.val(),0,'','&nbsp;')+'&nbsp;руб.');cnt.find('.val2').css({display:'none'});}else{cnt.find('.val1').html(formatMoney(val1.val(),0,'','&nbsp;'));cnt.find('.val2').html(' - '+formatMoney(val2.val(),0,'','&nbsp;')+'&nbsp;руб.');}}).addClass('processed');}}$(function(){if($('#pageIDarticle').length){$('#pageIDarticle .ae-image-block').each(function(){var next=$(this).next();if(!next||!next.hasClass('ae-image-block')){$(this).css({'margin-bottom':'30px'});}});}window.chatcounterInject=setInterval(function(){if(typeof $!=='undefined'){if($('#carrot-messenger-frame').length>0){clearTimeout(window.chatcounterInject);var js='window.NeedOpenReg = false;\n\
var sab_el = document.getElementsByClassName(\'regWedWedBtn\');\n\
setInterval(function(){\n\
 for (var sab_i = 0; sab_i < sab_el.length; sab_i++) {\n\
 sab_el[sab_i].onclick = function(){\n\
 window.NeedOpenReg = true;\n\
 return false;\n\
 }\n\
 }\n\
},300);\n\
';var script='<script>'+js+'</script>';var myIframe=document.getElementById('carrot-messenger-frame');if(myIframe){$('#carrot-messenger-frame').contents().find('body').append(script);if($('#carrot-messenger-frame').length&&myIframe){setInterval(function(){var iframeWindow=myIframe.contentWindow||myIframe.contentDocument.parent;if(typeof iframeWindow!=='undefined'&&typeof iframeWindow.NeedOpenReg!=='undefined'&&iframeWindow.NeedOpenReg===true){iframeWindow.NeedOpenReg=false;$('.header-top__fuctionals.header-functionals a.header-functionals__register.js-popup').click();}},200);}}}}},300);initIdeaControl();});function initIdeaControl(){$('.del-idea:not(.processed)').click(function(e){e.preventDefault();if(confirm('Точно удалить?')){var id=$(this).data('id');var ths=this;$.ajax({url:'/api/delPin/',type:'post',data:{id:id},success:function(data){if(data==='ok'){$(ths).parent().remove();}}});}}).addClass('processed');$('#pinList .idea-item .idea-name:not(.processed)').dblclick(function(e){e.preventDefault();var item=$(this).parents('.idea-item');var id=$(this).data('id');var text=$(this);var str=$(this).text();window.strbkp=str;text.html('<input type="text" value="'+escapeHTMLEncode(str)+'" />');text.find('input').keyup(function(e){if(e.keyCode===27){$(this).parent().html(escapeHTMLEncode(window.strbkp));}if(e.keyCode===13){var str=$(this).val();$(this).parent().html(escapeHTMLEncode(str));if(str!==window.strbkp){let data={id:id,value:str};$.ajax({method:'POST',url:'/api/user/setIdeaName/',data:data,cache:false});}}}).on('blur',function(){var str=$(this).val();$(this).parent().html(escapeHTMLEncode(str));if(str!==window.strbkp){let data={id:id,value:str};$.ajax({method:'POST',url:'/api/user/setIdeaName/',data:data,cache:false});}}).get(0).focus();}).addClass('processed');$('#pinList .idea-item .edit-idea:not(.processed)').click(function(e){e.preventDefault();var id=$(this).data('id');let tpl='<div class="modal modal-customs fade" tabindex="-1" role="dialog" id="editIdeaModal" aria-hidden="true">'+'<div class="modal-dialog modal-lg" role="document">'+'<div class="modal-content">'+'<div class="modal-header">'+'<h5 class="modal-title">Редактирование фотоидеи</h5>'+'<button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">'+'<span aria-hidden="true">&times;</span>'+'</button>'+'</div>'+'<div class="modal-body">'+'<p>Загрузка...</p>'+'</div>'+'<div class="modal-footer">'+'<button type="button" class="btn btn-primary saveIdeaData">Сохранить</button>'+'<button type="button" class="btn btn-secondary" data-dismiss="modal">Отменить</button>'+'</div>'+'</div>'+'</div>'+'</div>';$('body').append(tpl);$('.saveIdeaData').hide();var modal=$('#editIdeaModal');var body=$('#editIdeaModal .modal-body');modal.modal({show:true}).on('hidden.bs.modal',function(){$('#editIdeaModal').remove();});var data={id:id};$.ajax({url:'/api/ideas/loadIdeaData/',data:data,method:'post',dataType:'json',success:function(data){$('.saveIdeaData').show();let html='';if(data){html=html+'<div class="form-group">'+'<label class="control-label col-lg-3" for="name">Название</label>'+'<div class="col-lg-9">'+'<input type="text" class="form-control" placeholder="Название" id="name" name="name" value="'+data.name+'">'+'</div>'+'</div>'+''+'<div class="form-group">'+'<label class="control-label col-lg-3">Категория</label>'+'<div class="col-lg-9">'+'<input type="text" class="form-control-multiline tagify-inp" name="category" data-whitelist="'+data.allcat.join(',')+'" value="'+data.category+'" name="category" />'+'</div>'+'</div>'+''+'<div class="form-group">'+'<label class="control-label col-lg-3">Тэги</label>'+'<div class="col-lg-9">'+'<textarea class="form-control-multiline tagify-inp" name="tags" data-whitelist="'+data.alltags.join(',')+'">'+data.tags+'</textarea>'+'</div>'+'</div>'+''+'<div class="form-group">'+'<label class="control-label col-lg-3">Стили</label>'+'<div class="col-lg-9">'+'<textarea class="form-control-multiline tagify-inp" name="styles" data-whitelist="'+data.allstyle.join(',')+'">'+data.styles+'</textarea>'+'</div>'+'</div>'+''+'<div class="form-group">'+'<label class="control-label col-lg-3">Цвета</label>'+'<div class="col-lg-9">'+'<textarea id="addColorTag" class="form-control-multiline" name="colors" data-whitelist="'+allColorNames.join(',')+'">'+data.colors+'</textarea>'+'</div>'+'</div>';if(data.src){html=html+'<div class="form-group text-center">'+'<label class="col-lg-12 text-center">Фото</label>'+'<img class="pipetka" src="'+data.src+'" height="400">'+'</div>';}}if(html===''){html='Что-то пошло не так';}else{html='<form class="form-horizontal"><input type="hidden" name="id" value="'+id+'">'+html+'</form>';}body.html(html);if(body.find('img.pipetka123').length){var img=body.find('img.pipetka').get(0);img.crossOrigin="Anonymous";img.addEventListener('load',function(){var canvas=document.createElement('canvas');$(img).parent().append(canvas);canvas=$(img).parent().find('canvas');if(canvas.length===1){canvas.css({cursor:'crosshair'});canvas=canvas.get(0);let newHidth=400;let newWidth=parseInt(newHidth*img.naturalWidth/img.naturalHeight);canvas.width=newWidth;canvas.height=newHidth;var ctx=canvas.getContext('2d');ctx.drawImage(img,0,0,newWidth,newHidth);$(img).hide();$(canvas).mouseleave(function(){$('#colorPreview').remove();}).mousemove(function(e){var ctx=this.getContext('2d');var canvasOffset=$(this).offset();var canvasX=Math.floor(e.pageX-canvasOffset.left);var canvasY=Math.floor(e.pageY-canvasOffset.top);if(canvasX===0){canvasX=1;}if(canvasY===0){canvasY=1;}if(canvasX===(newWidth-1)){canvasX=canvasX-1;}if(canvasY===(newHidth-1)){canvasY=canvasY-1;}var imageData=ctx.getImageData(canvasX-1,canvasY-1,3,3);var data=imageData.data;var red=0;var green=0;var blue=0;for(var i=0;i<data.length;i=i+4){red=red+data[i];green=green+data[i+1];blue=blue+data[i+2];}red=parseInt(red/(data.length/4));green=parseInt(green/(data.length/4));blue=parseInt(blue/(data.length/4));window.curcolor=[red,green,blue];var pixelColor="rgb("+window.curcolor[0]+", "+window.curcolor[1]+", "+window.curcolor[2]+")";if($('#colorPreview').length===0){$('body').append('<div id="colorPreview" style="position: absolute; width: 20px; height: 20px; border-radius: 4px; z-index:99999"></div>');}var prev=$('#colorPreview');prev.css({left:(e.pageX+5)+'px',top:(e.pageY-25)+'px',background:pixelColor});}).mousedown(function(e){let tmp=getClosestColorByRGB(window.curcolor);var jqTagify=window.tagify.data('tagify');jqTagify.addTags(colorNames[tmp]);});}});}body.find('input.tagify-inp,textarea.tagify-inp').tagify({maxTags:10,enforceWhitelist:true,dropdown:{maxItems:20,classname:"tags-look",enabled:0,closeOnSelect:false}});window.tagify=body.find('#addColorTag').tagify({maxTags:5,enforceWhitelist:true,dropdown:{maxItems:20,classname:"tags-look",enabled:0,closeOnSelect:false}});body.find('input.tagify-select,textarea.tagify-select').tagify({maxTags:1,mode:"select",enforceWhitelist:true,dropdown:{maxItems:20,classname:"tags-look",enabled:0,closeOnSelect:true}});body.find('form').submit(function(e){e.preventDefault();var name=modal.find('input[name=name]').val();$('.idea-name[data-id='+id+']').html(escapeHTMLEncode(name));var data=$(this).serializeArray();$.ajax({url:'/api/ideas/updateIdeaData/',dataType:'json',method:'post',data:data,success:function(data){if(data===true){modal.modal('hide');}}});});$('.saveIdeaData').click(function(){$(this).parents('.modal-content').find('.modal-body form').submit();});modal.modal('handleUpdate');}});}).addClass('processed');}function escapeHTMLEncode(str){var map={'<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'};var div=document.createElement('div');var text=document.createTextNode(str);div.appendChild(text);return div.innerHTML.replace(/[<>"']/g,function(m){return map[m];});}function hexToRgb(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b;});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)]:null;}const rgbToHex=(r,g,b)=>''+[r,g,b].map(x=>{const hex=x.toString(16)
return hex.length===1?'0'+hex:hex}).join('');function allHexToRgb(arr){let tmp=[];if(arr.length){for(let i=0;i<arr.length;i++){tmp[tmp.length]=hexToRgb('#'+arr[i]);}}return tmp;}function getClosestColor(color){if(color.length!==3){color=[0,0,0];}var closest={};var dist;for(var i=0;i<indexedColors.length;i++){dist=Math.pow(indexedColors[i][0]-color[0],2);dist+=Math.pow(indexedColors[i][1]-color[1],2);dist+=Math.pow(indexedColors[i][2]-color[2],2);dist=Math.sqrt(dist);if(!closest.dist||closest.dist>dist){closest.dist=dist;closest.color=indexedColors[i];}}return closest.color;}function getClosestColorByHex(color){let ttmp=getClosestColor(color);return rgbToHex(ttmp[0],ttmp[1],ttmp[2]).toString().toUpperCase();}function getClosestColorByRGB(color){let tmp=getClosestColor(color);return rgbToHex(tmp[0],tmp[1],tmp[2]).toString().toUpperCase();}$(function(){if($('div.city-guess').length>0){$('#chTown,#chTown2').click(function(){$(this).parent().toggleClass('active');});}});